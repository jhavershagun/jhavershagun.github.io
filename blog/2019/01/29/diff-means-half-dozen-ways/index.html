<!DOCTYPE html>
<html lang="en"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Shagun Jhaver">
    <meta name="description" content="Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan">
    <meta name="keywords" content="r, ggplot, tidyverse, stan, bayes">
    <meta name="generator" content="Hugo 0.88.1" />

    <title>
  Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups | Shagun Jhaver
</title>

    <link rel="canonical" href="https://www.shagunjhaver.com/blog/2019/01/29/diff-means-half-dozen-ways/">
    <link rel="alternate" type="application/atom+xml" title="Blog Posts" href="https://www.shagunjhaver.com/atom.xml">
    <link rel="alternate" type="application/json" title="JSON Feed" href="https://www.shagunjhaver.com/feed.json">

    <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud?source=profiles">
    <link rel="openid2.local_id" href="https://www.google.com/profiles/andrewheiss">

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://www.shagunjhaver.com/profiles/twitter-card-large.png?v=1"/>
    <meta name="twitter:site" content="@shagunjhaver"/>
    <meta name="twitter:title" content="Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups"/>
    <meta name="twitter:creator" content="@shagunjhaver"/>
    <meta name="twitter:description" content="Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan"/>


    <meta property="og:title" content="Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups" />
<meta property="og:description" content="Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.shagunjhaver.com/blog/2019/01/29/diff-means-half-dozen-ways/" />
<meta property="og:image" content="https://www.shagunjhaver.com/profiles/twitter-card-large.png"/>
<meta property="article:published_time" content="2019-01-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-01-29T00:00:00+00:00" />

<meta property="article:author" content="https://www.facebook.com/shagun.jhaver" />
<meta property="article:publisher" content="https://www.facebook.com/shagun.jhaver" />
<meta property="article:section" content="blog" />
<meta property="article:tag" content="r" />
<meta property="article:tag" content="ggplot" />
<meta property="article:tag" content="tidyverse" />
<meta property="article:tag" content="stan" />
<meta property="article:tag" content="bayes" />


    <meta itemprop="name" content="Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups">
<meta itemprop="description" content="Learn how to run standard t-tests, simulations, and Bayesian difference in means tests with R and Stan"><meta itemprop="datePublished" content="2019-01-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2019-01-29T00:00:00+00:00" />
<meta itemprop="wordCount" content="6095"><meta itemprop="image" content="https://www.shagunjhaver.com/profiles/twitter-card-large.png"/>
<meta itemprop="keywords" content="r,ggplot,tidyverse,stan,bayes," />

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/pure-and-grids-responsive.min.css">
    <link rel="stylesheet" href="/css/ath-hugo.min.fd8cb76e3e71e1679716940ae61a1383ae9edd503b072df4bc3f709182421c76.css" integrity="sha256-/Yy3bj5x4WeXFpQK5hoTg66e3VA7By30vD9wkYJCHHY=" crossorigin="anonymous" media="screen" />

    <script src="https://kit.fontawesome.com/f9d343c40d.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">    

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=dLX2MbQJLG">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=dLX2MbQJLG">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=dLX2MbQJLG">
    <link rel="manifest" href="/site.webmanifest?v=dLX2MbQJLG">
    <link rel="mask-icon" href="/safari-pinned-tab.svg?v=dLX2MbQJLG" color="#cf4446">
    <link rel="shortcut icon" href="/favicon.ico?v=dLX2MbQJLG">
    <meta name="msapplication-TileColor" content="#170c3a">
    <meta name="theme-color" content="#170c3a">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-527449-5', 'auto');
      ga('send', 'pageview');
    </script>
</head>

<body>

    <div id="layout" class="pure-g">
        <div id="sidebar" class="pure-u-1 pure-u-md-1-4">
            <header>
                <h1 class="title"><a href="/">Shagun Jhaver</a></h1>
                <h2 class="minibio">Social computing, CSCW, HCI, content moderation, and online harassment</h2>

                <nav id="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a class="nav-link" href="/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cv/">CV</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/research/">Research</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/news/">News</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/now/">Now</a>
                        </li>
                    </ul>
                </nav>
            </header>

        </div> 
    
        <div id="content" class="pure-u-1 pure-u-md-3-4">
        
  <section>
    <article class="content-single">
        <header class="post-header">
            <h1 class="post-title">Half a dozen frequentist and Bayesian ways to measure the difference in means in two groups</h1>

            <div class="post-meta pure-g">
                <div class="pure-u-1-2">
                    <span class="posted-on">
                        <i class="far fa-calendar-alt" aria-hidden="true"></i>
                        <time datetime='2019-01-29T00:00:00Z'>
                            Tuesday, January 29, 2019
                        </time>
                    </span>
                </div>
                <div class="reading-time pure-u-1-2">
                    <i class="far fa-clock" aria-hidden="true"></i>
                    29-minute read
                </div>
            </div>
        </header>
    
        <p><span class="small">(<a href="https://github.com/andrewheiss/diff-means-half-dozen-ways">See this notebook on GitHub</a>)</span></p>
<hr>
<p>Taking a sample from two groups from a population and seeing if there’s a significant or substantial difference between them is a standard task in statistics. Measuring performance on a test before and after some sort of intervention, measuring average GDP in two different continents, measuring average height in two groups of flowers, etc.—we like to know if any group differences we see are attributable to chance / measurement error, or if they’re real.</p>
<p>Classical frequentist statistics typically measures the difference between groups with a <a href="https://en.wikipedia.org/wiki/Student%27s_t-test">t-test</a>, but t-tests are 100+ years old and statistical methods have advanced a lot since 1908. Nowadays, we can use simulation and/or Bayesian methods to get richer information about the differences between two groups without worrying so much about the assumptions and preconditions for classical t-tests.</p>
<p>Mostly as a resource to future me, here are a bunch of different ways to measure the difference in means in two groups. I’ve done them all in real life projects, but I’m tired of constantly searching my computer for the code to do them:)</p>
<p>These ways can all be adapted to different situations (i.e. difference in proportions, one-sample difference in means, etc.). The process for simulation and Bayesian approaches will be roughly the same, while for frequentist approaches, you’ll need to walk through a <a href="https://www.google.com/search?q=statistical+test+workflow&amp;tbm=isch">statistical test workflow</a> to find the appropriate test.</p>
<p>Also, this is long and really kind of meant as a general reference. Here’s a tl;dr table of contents:</p>
<ul>
<li><a href="#data">Data</a></li>
<li><a href="#classical-frequentist-t-tests">Classical frequentist t-tests</a>
<ul>
<li><a href="#t-test-assuming-equal-variances">t-test, assuming equal variances</a></li>
<li><a href="#t-test-assuming-unequal-variance">t-test, assuming unequal variance</a></li>
</ul>
</li>
<li><a href="#simulation-based-tests">Simulation-based tests</a></li>
<li><a href="#bayesian-regression">Bayesian regression</a>
<ul>
<li><a href="#regression-assuming-equal-variances">Regression, assuming equal variances</a></li>
<li><a href="#a-quick-digression-into-priors">A quick digression into priors</a></li>
<li><a href="#regression-assuming-unequal-variances">Regression, assuming unequal variances</a></li>
<li><a href="#regression-best">Regression, BEST</a></li>
</ul>
</li>
<li><a href="#bayesian-analysis-directly-with-stan">Bayesian analysis, directly with Stan</a></li>
<li><a href="#regression-best-with-priors-on-variables-instead-of-difference">Regression, BEST, with priors on variables instead of difference</a></li>
<li><a href="#comparing-all-methods">Comparing all methods</a></li>
</ul>
<h2 id="data">Data</h2>
<p>First we need some data to play with. We’ll use the <a href="https://cran.r-project.org/package=ggplot2movies"><strong>ggplot2movies</strong> package</a>, which contains information about almost 60,000 movies from IMDB from 1893 to 2005. For this example, we want to see if there is a significant/substantial/real difference in the average IMDB rating for action movies and comedies. Are people more likely to rate comedies higher than action movies?</p>
<p>Instead of working with all 20,407 action movies and comedies, we take a random sample of 200 each. (This is just so we can have some variation in the group averages—if we work with all 20,000, the confidence intervals for each group average basically disappear since there are so many observations.)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Load libraries</span>
<span style="color:#a6e22e">library</span>(tidyverse)  <span style="color:#75715e"># ggplot, dplyr, and friends</span>
<span style="color:#a6e22e">library</span>(ggridges)   <span style="color:#75715e"># Ridge plots</span>
<span style="color:#a6e22e">library</span>(ggstance)   <span style="color:#75715e"># Horizontal pointranges and bars</span>
<span style="color:#a6e22e">library</span>(patchwork)  <span style="color:#75715e"># Lay out multiple ggplot plots; install from https://github.com/thomasp85/patchwork</span>
<span style="color:#a6e22e">library</span>(scales)     <span style="color:#75715e"># Nicer formatting for numbers</span>
<span style="color:#a6e22e">library</span>(broom)      <span style="color:#75715e"># Convert model results to tidy data frames</span>
<span style="color:#a6e22e">library</span>(infer)      <span style="color:#75715e"># Statistical inference with simulation</span>
<span style="color:#a6e22e">library</span>(rstan)      <span style="color:#75715e"># R interface to Stan</span>
<span style="color:#a6e22e">library</span>(brms)       <span style="color:#75715e"># Run Stan-based models with standard R syntax</span>
<span style="color:#a6e22e">library</span>(ggplot2movies)  <span style="color:#75715e"># Lots of movies from IMDB</span>


<span style="color:#75715e"># Clean up data</span>
<span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">1234</span>)  <span style="color:#75715e"># Set seed so we get the same sampled rows every time</span>
movies_clean <span style="color:#f92672">&lt;-</span> movies <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># Make a binary column for genre</span>
  <span style="color:#a6e22e">select</span>(title, year, rating, Action, Comedy) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(<span style="color:#f92672">!</span>(Action <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;</span> Comedy <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(genre <span style="color:#f92672">=</span> <span style="color:#a6e22e">case_when</span>(Action <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;Action&#34;</span>,
                           Comedy <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;Comedy&#34;</span>,
                           <span style="color:#66d9ef">TRUE</span> <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;Neither&#34;</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(genre <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;Neither&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#75715e"># Make a numeric version of genre, where action = 1, comedy = 2</span>
  <span style="color:#a6e22e">mutate</span>(genre_numeric <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(<span style="color:#a6e22e">factor</span>(genre))) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># Make genre a factor</span>
  <span style="color:#a6e22e">mutate</span>(genre <span style="color:#f92672">=</span> <span style="color:#a6e22e">factor</span>(genre)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(<span style="color:#f92672">-</span>Action, <span style="color:#f92672">-</span>Comedy) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># Randomly select 200 movies in each genre</span>
  <span style="color:#a6e22e">group_by</span>(genre) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">sample_n</span>(<span style="color:#ae81ff">200</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">ungroup</span>()
</code></pre></div><p>To get a sense of the data, we’ll do some quick exploratory data analysis with a bunch of different graph types.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Make a custom theme</span>
<span style="color:#75715e"># I&#39;m using Asap Condensed; download from </span>
<span style="color:#75715e"># https://fonts.google.com/specimen/Asap+Condensed</span>
theme_fancy <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  <span style="color:#a6e22e">theme_minimal</span>(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Asap Condensed&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">theme</span>(panel.grid.minor <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>())
}

eda_boxplot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ggplot</span>(movies_clean, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> genre, y <span style="color:#f92672">=</span> rating, fill <span style="color:#f92672">=</span> genre)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_boxplot</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_fill_manual</span>(values <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#0288b7&#34;</span>, <span style="color:#e6db74">&#34;#a90010&#34;</span>), guide <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_y_continuous</span>(breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Rating&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>()

eda_histogram <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ggplot</span>(movies_clean, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> rating, fill <span style="color:#f92672">=</span> genre)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_histogram</span>(binwidth <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_fill_manual</span>(values <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#0288b7&#34;</span>, <span style="color:#e6db74">&#34;#a90010&#34;</span>), guide <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_x_continuous</span>(breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Count&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Rating&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">facet_wrap</span>(<span style="color:#f92672">~</span> genre, nrow <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(panel.grid.major.x <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_blank</span>())

eda_ridges <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ggplot</span>(movies_clean, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> rating, y <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_rev</span>(genre), fill <span style="color:#f92672">=</span> genre)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">stat_density_ridges</span>(quantile_lines <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, quantiles <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_fill_manual</span>(values <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#0288b7&#34;</span>, <span style="color:#e6db74">&#34;#a90010&#34;</span>), guide <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">scale_x_continuous</span>(breaks <span style="color:#f92672">=</span> <span style="color:#a6e22e">seq</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">2</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Rating&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;White line shows median rating&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>()

(eda_boxplot <span style="color:#f92672">|</span> eda_histogram) <span style="color:#f92672">/</span> 
    eda_ridges <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">plot_annotation</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Do comedies get higher ratings than action movies?&#34;</span>,
                  subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Sample of 400 movies from IMDB&#34;</span>,
                  theme <span style="color:#f92672">=</span> <span style="color:#a6e22e">theme</span>(text <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Asap Condensed&#34;</span>),
                                plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(face <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>,
                                                          size <span style="color:#f92672">=</span> <span style="color:#a6e22e">rel</span>(<span style="color:#ae81ff">1.5</span>))))
</code></pre></div><p><img src="eda-plots-1.png" alt="Exploratory data analysis"></p>
<p>Initially, it looks like there might be a difference in average rating. Comedies tend to have higher ratings. We can calculate the difference with some <strong>dplyr</strong> <code>group_by() %&gt;% summarize()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">group_diffs <span style="color:#f92672">&lt;-</span> movies_clean <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">group_by</span>(genre) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">summarize</span>(avg_rating <span style="color:#f92672">=</span> <span style="color:#a6e22e">mean</span>(rating, na.rm <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(diff_means <span style="color:#f92672">=</span> avg_rating <span style="color:#f92672">-</span> <span style="color:#a6e22e">lead</span>(avg_rating))
group_diffs

<span style="color:#75715e">## # A tibble: 2 x 3</span>
<span style="color:#75715e">##   genre  avg_rating diff_means</span>
<span style="color:#75715e">##   &lt;fct&gt;       &lt;dbl&gt;      &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 Action       5.28     -0.682</span>
<span style="color:#75715e">## 2 Comedy       5.97     NA</span>
</code></pre></div><p>Yep. There’s a -0.6825 point difference in ratings. Action movies score 0.7 points lower than comedies, on average.</p>
<p>But how certain are we that that difference is real and not just due to sampling error? It’s time for inference!</p>
<h2 id="classical-frequentist-t-tests">Classical frequentist t-tests</h2>
<h3 id="t-test-assuming-equal-variances">t-test, assuming equal variances</h3>
<p>We can use a standard frequentist t-test to check if the group means are different. We can assume that the variances in the two groups are the same and run <code>t.test()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Assume equal variances</span>
t_test_eq <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t.test</span>(rating <span style="color:#f92672">~</span> genre, data <span style="color:#f92672">=</span> movies_clean, var.equal <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
t_test_eq

<span style="color:#75715e">## </span>
<span style="color:#75715e">##  Two Sample t-test</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## data:  rating by genre</span>
<span style="color:#75715e">## t = -4.4753, df = 398, p-value = 0.000009977</span>
<span style="color:#75715e">## alternative hypothesis: true difference in means is not equal to 0</span>
<span style="color:#75715e">## 95 percent confidence interval:</span>
<span style="color:#75715e">##  -0.9823168 -0.3826832</span>
<span style="color:#75715e">## sample estimates:</span>
<span style="color:#75715e">## mean in group Action mean in group Comedy </span>
<span style="color:#75715e">##               5.2845               5.9670</span>
</code></pre></div><p>The default output is helpful—the p-value is really tiny, which means there’s a tiny chance that we’d see a difference that big in group means in a world where there’s no difference. However, in this format, it’s hard to extract any of these values for later use, like in plotting. We can use the <code>tidy()</code> function from the <strong>broom</strong> library to convert these t-test results to a nice data frame.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">t_test_eq_tidy <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tidy</span>(t_test_eq) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># Calculate difference in means, since t.test() doesn&#39;t actually do that</span>
  <span style="color:#a6e22e">mutate</span>(estimate <span style="color:#f92672">=</span> estimate1 <span style="color:#f92672">-</span> estimate2) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#75715e"># Rearrange columns</span>
  <span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">starts_with</span>(<span style="color:#e6db74">&#34;estimate&#34;</span>), <span style="color:#a6e22e">everything</span>())

t_test_eq_tidy

<span style="color:#75715e">## # A tibble: 1 x 10</span>
<span style="color:#75715e">##   estimate1 estimate2 estimate statistic p.value parameter conf.low</span>
<span style="color:#75715e">##       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span style="color:#75715e">## 1      5.28      5.97   -0.682     -4.48 9.98e-6       398   -0.982</span>
<span style="color:#75715e">## # … with 3 more variables: conf.high &lt;dbl&gt;, method &lt;chr&gt;,</span>
<span style="color:#75715e">## #   alternative &lt;chr&gt;</span>
</code></pre></div><p>By default, though, R does not assume that the variance in the two groups’ populations is equal, which is probably a reasonable thing to do. There may be structural differences in how comedies and action movies are produced, which in turn leads to structural differences in how they’re rated.</p>
<p>There are several systematic ways to check if the two groups have equal variance. For all these tests, the null hypothesis is that the two groups have similar (homogeneous) variances. If the p-value is less than 0.05, we can assume that they have unequal or heterogeneous variances. (<a href="https://statistic-on-air.blogspot.com/2009/07/analysis-of-variance-anova-for-multiple.html">Here’s a helpful overview</a> of this process.)</p>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Bartlett%27s_test"><strong>Bartlett test</strong></a>: Check homogeneity of variances based on the mean</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">bartlett.test</span>(rating <span style="color:#f92672">~</span> genre, data <span style="color:#f92672">=</span> movies_clean)

<span style="color:#75715e">## </span>
<span style="color:#75715e">##  Bartlett test of homogeneity of variances</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## data:  rating by genre</span>
<span style="color:#75715e">## Bartlett&#39;s K-squared = 0.10006, df = 1, p-value = 0.7518</span>
</code></pre></div></li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Levene%27s_test"><strong>Levene test</strong></a>: Check homogeneity of variances based on the median, so it’s more robust to outliers</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Install the car package first</span>
car<span style="color:#f92672">::</span><span style="color:#a6e22e">leveneTest</span>(rating <span style="color:#f92672">~</span> genre, data <span style="color:#f92672">=</span> movies_clean)

<span style="color:#75715e">## Levene&#39;s Test for Homogeneity of Variance (center = median)</span>
<span style="color:#75715e">##        Df F value Pr(&gt;F)</span>
<span style="color:#75715e">## group   1  0.4917 0.4836</span>
<span style="color:#75715e">##       398</span>
</code></pre></div></li>
<li>
<p><a href="https://biostats.w.uib.no/test-for-homogeneity-of-variances-levenes-test/"><strong>Fligner-Killeen test</strong></a>: Check homogeneity of variances based on the median, so it’s more robust to outliers</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fligner.test</span>(rating <span style="color:#f92672">~</span> genre, data <span style="color:#f92672">=</span> movies_clean)

<span style="color:#75715e">## </span>
<span style="color:#75715e">##  Fligner-Killeen test of homogeneity of variances</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## data:  rating by genre</span>
<span style="color:#75715e">## Fligner-Killeen:med chi-squared = 0.78337, df = 1, p-value = 0.3761</span>
</code></pre></div></li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Kruskal%E2%80%93Wallis_one-way_analysis_of_variance"><strong>Kruskal-Wallis test</strong></a>: Check homogeneity of distributions nonparametrically</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">kruskal.test</span>(rating <span style="color:#f92672">~</span> genre, data <span style="color:#f92672">=</span> movies_clean)

<span style="color:#75715e">## </span>
<span style="color:#75715e">##  Kruskal-Wallis rank sum test</span>
<span style="color:#75715e">## </span>
<span style="color:#75715e">## data:  rating by genre</span>
<span style="color:#75715e">## Kruskal-Wallis chi-squared = 19.787, df = 1, p-value = 0.000008655</span>
</code></pre></div></li>
</ul>
<p>Phew. In all these tests except the Kruskall-Wallis test, we don’t have enough evidence to conclude that the variances are different, so we’re probably safe leaving <code>var.equal = TRUE</code> on.</p>
<h3 id="t-test-assuming-unequal-variance">t-test, assuming unequal variance</h3>
<p>We can run a t-test assuming that the two groups have unequal variances by setting <code>var.equal = FALSE</code>, or just leaving it off. I generally just do this instead of going through all the tests for equal variance.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Assume unequal variances</span>
t_test_uneq <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">t.test</span>(rating <span style="color:#f92672">~</span> genre, data <span style="color:#f92672">=</span> movies_clean)
t_test_uneq_tidy <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tidy</span>(t_test_uneq) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(estimate <span style="color:#f92672">=</span> estimate1 <span style="color:#f92672">-</span> estimate2) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">starts_with</span>(<span style="color:#e6db74">&#34;estimate&#34;</span>), <span style="color:#a6e22e">everything</span>())
t_test_uneq_tidy

<span style="color:#75715e">## # A tibble: 1 x 10</span>
<span style="color:#75715e">##   estimate estimate1 estimate2 statistic p.value parameter conf.low</span>
<span style="color:#75715e">##      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span style="color:#75715e">## 1   -0.682      5.28      5.97     -4.48 9.98e-6      398.   -0.982</span>
<span style="color:#75715e">## # … with 3 more variables: conf.high &lt;dbl&gt;, method &lt;chr&gt;,</span>
<span style="color:#75715e">## #   alternative &lt;chr&gt;</span>
</code></pre></div><h2 id="simulation-based-tests">Simulation-based tests</h2>
<p>Instead of dealing with all the assumptions of the data and finding the exact statistical test written by some dude in the 1940s, we can use the power of bootstrapping, permutation, and simulation to construct a null distribution and calculate confidence intervals. According to Allen Downey, <a href="http://allendowney.blogspot.com/2016/06/there-is-still-only-one-test.html">there is actually only one statistical test</a> and that at their core, all statistical tests follow the same universal pattern:</p>
<ul>
<li><strong>Step 1: Calculate a sample statistic, or $\delta$.</strong> This is the main measure you care about: the difference in means, the average, the median, the proportion, the difference in proportions, the chi-squared value, etc.</li>
<li><strong>Step 2: Use simulation to invent a world where $\delta$ is null.</strong> Simulate what the world would look like if there was no difference between two groups, or if there was no difference in proportions, or where the average value is a specific number.</li>
<li><strong>Step 3: Look at $\delta$ in the null world.</strong> Put the sample statistic in the null world and see if it fits well.</li>
<li><strong>Step 4: Calculate the probability that $\delta$ could exist in null world.</strong> This is the p-value, or the probability that you’d see a $\delta$ at least that high in a world where there’s no difference.</li>
<li><strong>Step 5: Decide if $\delta$ is statistically significant.</strong> Choose some evidentiary standard or threshold (like 0.05) for deciding if there’s sufficient proof for rejecting the null world.</li>
</ul>
<p>I have <a href="https://www.andrewheiss.com/blog/2018/12/05/test-any-hypothesis/">a fully commented example of how to do this with the <strong>infer</strong> package here</a>. Once you get the hang of it, the <a href="https://github.com/tidymodels/infer"><strong>infer</strong> workflow</a> is fairly intuitive and flexible and far more delightful than worrying about classical tests.</p>
<p>First we calculate the difference in means in the actual data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Calculate the difference in means</span>
diff_means <span style="color:#f92672">&lt;-</span> movies_clean <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">specify</span>(rating <span style="color:#f92672">~</span> genre) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#75715e"># Order here means we subtract comedy from action (Action - Comedy)</span>
  <span style="color:#a6e22e">calculate</span>(<span style="color:#e6db74">&#34;diff in means&#34;</span>, order <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Action&#34;</span>, <span style="color:#e6db74">&#34;Comedy&#34;</span>))
diff_means

<span style="color:#75715e">## # A tibble: 1 x 1</span>
<span style="color:#75715e">##     stat</span>
<span style="color:#75715e">##    &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 -0.682</span>
</code></pre></div><p>Then we can generate a bootstrapped distribution of the difference in means based on our sample and calculate the confidence interval:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">boot_means <span style="color:#f92672">&lt;-</span> movies_clean <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">specify</span>(rating <span style="color:#f92672">~</span> genre) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">generate</span>(reps <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bootstrap&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">calculate</span>(<span style="color:#e6db74">&#34;diff in means&#34;</span>, order <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Action&#34;</span>, <span style="color:#e6db74">&#34;Comedy&#34;</span>))

boostrapped_confint <span style="color:#f92672">&lt;-</span> boot_means <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">get_confidence_interval</span>()

boot_means <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">visualize</span>() <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">shade_confidence_interval</span>(boostrapped_confint,
                            color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#8bc5ed&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#85d9d2&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> diff_means<span style="color:#f92672">$</span>stat, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#77002c&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Bootstrapped distribution of differences in means&#34;</span>,
       x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Action − Comedy&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Count&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Red line shows observed difference; shaded area shows 95% confidence interval&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>()
</code></pre></div><p><img src="sim-boot-1.png" alt="Bootstrapped confidence interval"></p>
<p>Neat. We have a simulation-based confidence interval, and it doesn’t contain zero, so we can have some confidence that there’s a real difference between the two groups.</p>
<p>We can go through the testing process more thoroughly by following Downey’s process. We’ve already done step one (calculate $\delta$); next we generate a world where there’s no difference by shuffling all the action/comedy labels through permutation</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Step 2: Invent a world where δ is null</span>
genre_diffs_null <span style="color:#f92672">&lt;-</span> movies_clean <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">specify</span>(rating <span style="color:#f92672">~</span> genre) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">hypothesize</span>(null <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;independence&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">generate</span>(reps <span style="color:#f92672">=</span> <span style="color:#ae81ff">5000</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;permute&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">calculate</span>(<span style="color:#e6db74">&#34;diff in means&#34;</span>, order <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Action&#34;</span>, <span style="color:#e6db74">&#34;Comedy&#34;</span>))

<span style="color:#75715e"># Step 3: Put actual observed δ in the null world and see if it fits</span>
genre_diffs_null <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">visualize</span>() <span style="color:#f92672">+</span> 
  <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> diff_means<span style="color:#f92672">$</span>stat, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#77002c&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_y_continuous</span>(labels <span style="color:#f92672">=</span> comma) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Simulated difference in average ratings (Action − Comedy)&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Count&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Simulation-based null distribution of differences in means&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Red line shows observed difference&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>()
</code></pre></div><p><img src="sim-generate-null-world-1.png" alt="Simulated p-value"></p>
<p>That red line is pretty far to the left and seems like it wouldn’t fit very well in a world where there’s no actual difference between the groups. We can calculate the probability of seeing that red line in a null world (step 4) with <code>get_p_value()</code> (and we can use the cool new <code>pvalue()</code> function in the <strong>scales</strong> library to format it as &lt; 0.001):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Step 4: Calculate probability that observed δ could exist in null world</span>
genre_diffs_null <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">get_p_value</span>(obs_stat <span style="color:#f92672">=</span> diff_means, direction <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;both&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(p_value_clean <span style="color:#f92672">=</span> <span style="color:#a6e22e">pvalue</span>(p_value))

<span style="color:#75715e">## # A tibble: 1 x 2</span>
<span style="color:#75715e">##   p_value p_value_clean</span>
<span style="color:#75715e">##     &lt;dbl&gt; &lt;chr&gt;        </span>
<span style="color:#75715e">## 1       0 &lt;0.001</span>
</code></pre></div><p>Because the p-value is so small, it passes pretty much all evidentiary thresholds (p &lt; 0.05, p &lt; 0.01, etc), so we can safely say that there’s a difference between the two groups. Action movies are rated lower, on average, than comedies.</p>
<h2 id="bayesian-regression">Bayesian regression</h2>
<p>Next we can leave the world of frequentist statistics and null hypothesis testing and do some Bayesian analysis. Frequentist null hypothesis significance testing (NHST) determines the <em>probability of the data given a null hypothesis</em> (i.e. $P(\text{data} | H)$, yielding results that are often unwieldy, phrased as the probability of rejecting the null if it is true (hence all that talk of “null worlds” earlier). In contrast, Bayesian analysis determines the <em>probability of a hypothesis given the data</em> (i.e.$P(H | \text{data})$), resulting in probabilities that are directly interpretable.</p>
<p>Bayesian analysis is way more computationally intensive and requires more upfront work (e.g prior specification). Because of this, R itself doesn’t have robust support for the actual Monte Carlo sampling and other computational heavy lifting involved in Bayesian stuff. Instead, it can connect to external sampling programs that are optimized for this kind of repetitive simulation work. <a href="https://en.wikipedia.org/wiki/Bayesian_inference_using_Gibbs_sampling">BUGS</a> and <a href="http://mcmc-jags.sourceforge.net/">JAGS</a> were popular sampling software tools, but nowadays all the cool kids are using <a href="https://mc-stan.org/">Stan</a>.</p>
<p>Writing Stan code by hand is tricky since it requires that you essentially learn another programming language. Fortunately, you technically can do Bayesian analysis without writing a single line of Stan code. There are two different packages that precompile Stan code for you:</p>
<ul>
<li><a href="https://mc-stan.org/users/interfaces/rstanarm"><strong>rstanarm</strong></a>: This is written by the Stan team itself and provides functions like <code>stan_lm()</code> and <code>stan_glm()</code> that are drop-in replacements for R’s standard <code>lm()</code> and <code>glm()</code>. The code is highly optimized and precompiled and runs really fast, but there’s no good way to inspect the underlying Stan code. Also, it’s more limited in the types of regression it supports.</li>
<li><a href="https://github.com/paul-buerkner/brms"><strong>brms</strong></a>: This provides a more universal front end for Stan and supports a wider variety of models. It doesn’t have drop-in <code>lm()</code> replacements, but the <code>brm()</code> function is fairly intuitive after poring through the documentation and examples. It’s slower than <strong>rstanarm</strong> because it has to compile the Stan scripts it generates with C++, but you can inspect the Stan code behind each of the models with <code>stancode()</code> and better see what’s going on behind the scenes.</li>
</ul>
<p>There aren’t really any cool front end packages for running non-regression analyses with Stan from R (there is <a href="http://www.sumsar.net/blog/2014/02/bayesian-first-aid-one-sample-t-test/">Rasmus Bååth’s Bayesian First Aid package</a>, but it uses JAGS and hasn’t been updated in a while and I want to use Stan like the cool kids), but you can actually calculate differences in means with regression, which means we can approximate frequentist t-tests without writing any Stan code.</p>
<p><a href="https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/">This blog post by Matti Vuorre</a> is a masterpiece and clearly explains the rationale behind how and why you can use regression for t-tests. This code here is adapted from his stuff.</p>
<p>First, we’ll set a bunch of Monte Carlo parameters:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">CHAINS <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">4</span>
ITER <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">2000</span>
WARMUP <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1000</span>
BAYES_SEED <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1234</span>
<span style="color:#a6e22e">options</span>(mc.cores <span style="color:#f92672">=</span> parallel<span style="color:#f92672">::</span><span style="color:#a6e22e">detectCores</span>())  <span style="color:#75715e"># Use all cores</span>
</code></pre></div><h3 id="regression-assuming-equal-variances">Regression, assuming equal variances</h3>
<p>Then we can run the model. We set a couple priors for the intercept (normal, with a mean of 0 and standard deviation of 5) and the beta/slope (normal, with a mean of 0 and a standard deviation of 1). In this model, <code>rating ~ genre</code>, we assume equal variances between the groups.</p>
<p>We use <code>tidyMCMC</code> from <strong>broom</strong> to calculate the medians of the posterior distributions and create confidence intervals.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_eq <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">brm</span>(
  <span style="color:#75715e"># bf() is an alias for brmsformula() and lets you specify model formulas</span>
  <span style="color:#a6e22e">bf</span>(rating <span style="color:#f92672">~</span> genre), 
  <span style="color:#75715e"># Reverse the levels of genre so that comedy is the base case</span>
  data <span style="color:#f92672">=</span> <span style="color:#a6e22e">mutate</span>(movies_clean, genre <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_rev</span>(genre)),
  prior <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;normal(0, 5)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Intercept&#34;</span>),
            <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;normal(0, 1)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;b&#34;</span>)),
  chains <span style="color:#f92672">=</span> CHAINS, iter <span style="color:#f92672">=</span> ITER, warmup <span style="color:#f92672">=</span> WARMUP, seed <span style="color:#f92672">=</span> BAYES_SEED,
  file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cache/brms_eq&#34;</span>
)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_eq_tidy <span style="color:#f92672">&lt;-</span> 
  <span style="color:#a6e22e">tidyMCMC</span>(brms_eq, conf.int <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, conf.level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.95</span>, 
           estimate.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;median&#34;</span>, conf.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HPDinterval&#34;</span>)
brms_eq_tidy

<span style="color:#75715e">## # A tibble: 3 x 5</span>
<span style="color:#75715e">##   term          estimate std.error conf.low conf.high</span>
<span style="color:#75715e">##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 b_Intercept      5.96     0.108     5.74      6.16 </span>
<span style="color:#75715e">## 2 b_genreAction   -0.666    0.152    -0.968    -0.374</span>
<span style="color:#75715e">## 3 sigma            1.53     0.0529    1.43      1.64</span>
</code></pre></div><p>Here the intercept represents the mean comedy score, while the coefficient for action represents the difference from that mean, or the effect that we care about. These findings match what we got with the frequentist work from earlier, only now we can change the interpretation: We’re 95% confident that the true population-level difference in rating is between -0.968 and -0.374, with a median of -0.666.</p>
<h3 id="a-quick-digression-into-priors">A quick digression into priors</h3>
<p>If you don’t explicitly set any priors, <strong>brms</strong> chooses sensible defaults for you. You can see what priors you can potentially set with <code>get_prior()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">get_prior</span>(<span style="color:#a6e22e">bf</span>(rating <span style="color:#f92672">~</span> genre), data <span style="color:#f92672">=</span> movies_clean)

<span style="color:#75715e">##                 prior     class        coef group resp dpar nlpar bound</span>
<span style="color:#75715e">## 1                             b                                        </span>
<span style="color:#75715e">## 2                             b genreComedy                            </span>
<span style="color:#75715e">## 3 student_t(3, 6, 10) Intercept                                        </span>
<span style="color:#75715e">## 4 student_t(3, 0, 10)     sigma</span>
</code></pre></div><p>You can use this table to select which prior you want to set. For instance, to specify the prior distribution for the intercept, you can use <code>set_prior(&quot;normal(0, 5)&quot;, class = &quot;Intercept&quot;)</code>, which matches the table. More complicated formulas will have values in the <code>dpar</code> and <code>nlpar</code> columns, and you can use those to drill down to specific priors for those terms (e.g. <code>set_prior(&quot;cauchy(0, 1)&quot;, class = &quot;b&quot;, dpar = &quot;sigma&quot;)</code>).</p>
<p>Also, you can plot the different distributions to get a sense of their shapes with either base R or with ggplot:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Normal distribution: normal(0, 5)</span>
<span style="color:#a6e22e">curve</span>(expr <span style="color:#f92672">=</span> <span style="color:#a6e22e">dnorm</span>(x, mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>), from <span style="color:#f92672">=</span> <span style="color:#ae81ff">-20</span>, to <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>)
</code></pre></div><figure class="img-50"><img src="dist-base-norm-1.png"
         alt="Normal distribution"/>
</figure>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Cauchy distribution: cauchy(0, 1)</span>
<span style="color:#a6e22e">curve</span>(expr <span style="color:#f92672">=</span> <span style="color:#a6e22e">dcauchy</span>(x, location <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>), from <span style="color:#f92672">=</span> <span style="color:#ae81ff">-5</span>, to <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>)
</code></pre></div><figure class="img-50"><img src="dist-base-cauchy-1.png"
         alt="Cauchy distribution"/>
</figure>

<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Or do this with ggplot</span>
norm_ggplot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> <span style="color:#a6e22e">tibble</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-20</span>, <span style="color:#ae81ff">20</span>)), <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">stat_function</span>(fun <span style="color:#f92672">=</span> dnorm, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>, args <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;normal(0, 5)&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>()

cauchy_ggplot <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> <span style="color:#a6e22e">tibble</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-5</span>, <span style="color:#ae81ff">5</span>)), <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">stat_function</span>(fun <span style="color:#f92672">=</span> dcauchy, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>, args <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(location <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cauchy(0, 1)&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>()

norm_ggplot <span style="color:#f92672">/</span> cauchy_ggplot
</code></pre></div><figure class="img-75"><img src="dists-ggplot-1.png"
         alt="Normal and Cauchy distributions with ggplot"/>
</figure>

<h3 id="regression-assuming-unequal-variances">Regression, assuming unequal variances</h3>
<p>We can also use regression to estimate the difference in means under the assumption that group variances are different. Here, following <a href="https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#equal-variances-model">Matti Vuorre</a>, we need to model the variance (or sigma) in each group, and we need to specify a prior for that term (I chose <code>cauchy(0, 1</code>). We do this by specifying two formulas in <code>brm()</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_uneq <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">brm</span>(
  <span style="color:#a6e22e">bf</span>(rating <span style="color:#f92672">~</span> genre, sigma <span style="color:#f92672">~</span> genre), 
  data <span style="color:#f92672">=</span> <span style="color:#a6e22e">mutate</span>(movies_clean, genre <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_rev</span>(genre)),
  prior <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;normal(0, 5)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Intercept&#34;</span>),
            <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;normal(0, 1)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;b&#34;</span>),
            <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;cauchy(0, 1)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;b&#34;</span>, dpar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sigma&#34;</span>)),
  chains <span style="color:#f92672">=</span> CHAINS, iter <span style="color:#f92672">=</span> ITER, warmup <span style="color:#f92672">=</span> WARMUP, seed <span style="color:#f92672">=</span> BAYES_SEED,
  file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cache/brms_uneq&#34;</span>
)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_uneq_tidy <span style="color:#f92672">&lt;-</span> 
  <span style="color:#a6e22e">tidyMCMC</span>(brms_uneq, conf.int <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, conf.level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.95</span>, 
           estimate.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;median&#34;</span>, conf.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HPDinterval&#34;</span>)
brms_uneq_tidy

<span style="color:#75715e">## # A tibble: 4 x 5</span>
<span style="color:#75715e">##   term                estimate std.error conf.low conf.high</span>
<span style="color:#75715e">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 b_Intercept           5.96      0.111     5.73      6.17 </span>
<span style="color:#75715e">## 2 b_sigma_Intercept     0.433     0.0494    0.335     0.528</span>
<span style="color:#75715e">## 3 b_genreAction        -0.665     0.156    -0.979    -0.371</span>
<span style="color:#75715e">## 4 b_sigma_genreAction  -0.0199    0.0702   -0.161     0.113</span>
</code></pre></div><p>For mathy reasons (again, <a href="https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#unequal-variances-model">see Matti Vourre’s post</a>), the sigma terms are on a log scale, so we need to exponentiate them back to the scale of the data.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_uneq_tidy <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate_at</span>(<span style="color:#a6e22e">vars</span>(estimate, std.error, conf.low, conf.high),
            <span style="color:#a6e22e">funs</span>(<span style="color:#a6e22e">ifelse</span>(<span style="color:#a6e22e">str_detect</span>(term, <span style="color:#e6db74">&#34;sigma&#34;</span>), <span style="color:#a6e22e">exp</span>(.), .)))

<span style="color:#75715e">## # A tibble: 4 x 5</span>
<span style="color:#75715e">##   term                estimate std.error conf.low conf.high</span>
<span style="color:#75715e">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 b_Intercept            5.96      0.111    5.73      6.17 </span>
<span style="color:#75715e">## 2 b_sigma_Intercept      1.54      1.05     1.40      1.70 </span>
<span style="color:#75715e">## 3 b_genreAction         -0.665     0.156   -0.979    -0.371</span>
<span style="color:#75715e">## 4 b_sigma_genreAction    0.980     1.07     0.851     1.12</span>
</code></pre></div><p>Here, the interpretation for the intercept and action coefficients are the same as before: the intercept the average comedy rating; the action coefficient is the change from the average comedy rating, or the effect we care about. The sigmas work similarly: the intercept sigma is the standard deviation for comedies; the intercept sigma + action sigma is the standard deviation for action movies.</p>
<h3 id="regression-best">Regression, BEST</h3>
<p>A more robust way of estimating group differences Bayesianly is to use John Kruschke’s <a href="https://psycnet.apa.org/doi/10.1037/a0029146">Bayesian Estimation Supersedes the t Test (BEST)</a> method. I’m 100% not going into the nitty gritty details of this (<a href="https://vuorre.netlify.com/post/2017/01/02/how-to-compare-two-groups-with-robust-bayesian-estimation-using-r-stan-and-brms/#robust-bayesian-estimation">Matti Vuorre has, though</a>). In the most simplest terms, the only difference between BEST and the unequal variance regression above is that we model the data with a t distribution, which means we have a new parameter, $\nu$ (nu), that changes the normality of the distribution (i.e. the degrees of freedom parameter in a t distribution). Kruschke uses an exponential prior with a rate of 1/29 in his paper, so we do too. It looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> <span style="color:#a6e22e">tibble</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span>)), <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">stat_function</span>(fun <span style="color:#f92672">=</span> dexp, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>, args <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">/</span><span style="color:#ae81ff">29</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;exponential(1/29)&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>()
</code></pre></div><figure class="img-75"><img src="dist-exp-1.png"
         alt="Exponential distribution"/>
</figure>

<p>Add <code>family = student</code> and set the prior for <code>nu</code> and we’re ready to go:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_uneq_robust <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">brm</span>(
  <span style="color:#a6e22e">bf</span>(rating <span style="color:#f92672">~</span> genre, sigma <span style="color:#f92672">~</span> genre), 
  family <span style="color:#f92672">=</span> student,
  data <span style="color:#f92672">=</span> <span style="color:#a6e22e">mutate</span>(movies_clean, genre <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_rev</span>(genre)),
  prior <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;normal(0, 5)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Intercept&#34;</span>),
            <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;normal(0, 1)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;b&#34;</span>),
            <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;cauchy(0, 1)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;b&#34;</span>, dpar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sigma&#34;</span>),
            <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;exponential(1.0/29)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;nu&#34;</span>)),
  chains <span style="color:#f92672">=</span> CHAINS, iter <span style="color:#f92672">=</span> ITER, warmup <span style="color:#f92672">=</span> WARMUP, seed <span style="color:#f92672">=</span> BAYES_SEED,
  file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cache/brms_uneq_robust&#34;</span>
)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_uneq_robust_tidy <span style="color:#f92672">&lt;-</span> 
  <span style="color:#a6e22e">tidyMCMC</span>(brms_uneq_robust, conf.int <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, conf.level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.95</span>, 
           estimate.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;median&#34;</span>, conf.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HPDinterval&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># Rescale sigmas</span>
  <span style="color:#a6e22e">mutate_at</span>(<span style="color:#a6e22e">vars</span>(estimate, std.error, conf.low, conf.high),
            <span style="color:#a6e22e">funs</span>(<span style="color:#a6e22e">ifelse</span>(<span style="color:#a6e22e">str_detect</span>(term, <span style="color:#e6db74">&#34;sigma&#34;</span>), <span style="color:#a6e22e">exp</span>(.), .)))
brms_uneq_robust_tidy

<span style="color:#75715e">## # A tibble: 5 x 5</span>
<span style="color:#75715e">##   term                estimate std.error conf.low conf.high</span>
<span style="color:#75715e">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 b_Intercept            5.98      0.104    5.77      6.17 </span>
<span style="color:#75715e">## 2 b_sigma_Intercept      1.47      1.06     1.31      1.66 </span>
<span style="color:#75715e">## 3 b_genreAction         -0.680     0.148   -0.966    -0.394</span>
<span style="color:#75715e">## 4 b_sigma_genreAction    0.999     1.08     0.860     1.16 </span>
<span style="color:#75715e">## 5 nu                    31.9      27.5      5.62     95.1</span>
</code></pre></div><p>Neato. Just like the other models, the coefficient for action shows us the difference in means (and it’s super similar to everything else). We can exponentiate the sigma coefficients and see the group standard deviations, and we have a coefficient for $\nu$, or the degrees of freedom for the underlying distribution.</p>
<h2 id="bayesian-analysis-directly-with-stan">Bayesian analysis, directly with Stan</h2>
<p><strong>Update</strong>: <a href="https://mikedecr.github.io/">Mike DeCrescenzo</a> made a <a href="https://twitter.com/mikedecr/status/1090416939917340672">fascinating point on Twitter</a> that relying on regression for t-test-like analysis with Bayesianism actually has important theoretical implications. When specifying a model as <code>y ~ a + bx</code> as we did above with <code>rating ~ genre</code>, the coefficient for genre (<code>b</code>) is actually the difference in means and doesn&rsquo;t directly reflect the rating itself. In theory, if we&rsquo;re thinking about two groups with two different variances, we should model the distribution of each group, not the distribution of the differences in groups. Analyzing the distributions of the two groups separately and <em>then</em> calculating the difference should yield more transparent results. And that&rsquo;s why we can/should do the analysis in Stan by hand like this.</p>
<p><strong>Another update</strong>: <a href="https://twitter.com/tjmahr/status/1090417050600816641?s=21">According to TJ Mahr</a>, you can get around this beta-for-the-difference issue by running a model like <code>rating ~ 0 + genre</code>, which suppresses the intercept and estimates coefficients for both groups directly. You have to calculate the difference in coefficients/group means by hand after, but at least you&rsquo;ll be estimating the right things.</p>
<p>Instead of using regression models and combining coefficients to figure out group means and differences, we can be brave and write actual Stan code that can return any value we want. We don’t have to be constrained by regression formulas, but we do have to figure out how to code in Stan, which is intimidating.</p>
<p>There are lots of resources out there for Stan (and Bayesianism in general), including <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath’s <em>Statistical Rethinking</em></a>, which has all its code in raw Stan <em>and</em> brms syntax. John Kruschke’s <em>Doing Bayesian Data Analysis</em> book includes code in both JAGS and Stan (click on <a href="https://sites.google.com/site/doingbayesiandataanalysis/software-installation">the link in step 5 here</a>; the code for BEST analysis is in the file named <code>Stan-Ymet-Xnom2grp-MrobustHet.R</code>).</p>
<p>But the resource that made the structure of Stan files (mostly) click for me was a recorded class (specifically <a href="https://www.youtube.com/watch?v=-mfeHHLcb1g">the session from 2017-01-30</a>) by <a href="https://github.com/mike-lawrence">Mike Lawrence</a> (a Canadian researcher) that <a href="https://discourse.mc-stan.org/t/what-would-be-a-good-resource-to-understand-the-method-of-two-sample-bayesian-hypothesis-testing/1492/6">I stumbled on</a> while searching the internet for ways to run BEST with Stan. Though the video is super long (you can skip around and/or watch at 2x speed; the two-sample example starts at minute 52), Mike clearly lays out the process for writing a Stan file and it’s the coolest thing ever. EVEN BETTER is the fact that he provides <a href="https://www.dropbox.com/sh/js0us2461w98bn7/AADcxczFADrCfnSA2qo8Gb2wa?dl=0">all the code from his class on Dropbox</a> (see the <a href="https://www.dropbox.com/sh/js0us2461w98bn7/AACjhob9JjkfncwkEjyI2-Pxa/2017-01-30?dl=0&amp;subfolder_nav_tracking=1">code from 2017-01-30</a> for t-test related stuff)</p>
<p>Through a combination of Mike Lawrence’s video, <a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/Bayesian/rstant_testBEST.R">Michael Clark’s BEST implementation here</a>, John Kruschke’s Stan code, and lots of debugging, <a href="imdb_best.stan">I created this Stan code</a>. Explaining the whole logic behind it goes way beyond the scope of this blog post, but I heavily commented it so it should be easy-ish to follow if you understand Stan files (which I still don’t completely ¯\_(ツ)_/¯).</p>
<p><a href="https://github.com/andrewheiss/diff-means-half-dozen-ways/blob/master/imdb_best.stan">Download <code>fancy-best.stan</code></a> and put it in the same folder as whatever script you’re typing in (or change the path to match wherever you put it). Note how the <code>data</code> argument in <code>sampling()</code> doesn’t just take a data frame like in <code>brm()</code>. We have to pass Stan specific pieces of data, all of which are specified in the <code>data{}</code> block in the Stan script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stan_best <span style="color:#f92672">&lt;-</span> 
  <span style="color:#a6e22e">sampling</span>(<span style="color:#a6e22e">stan_model</span>(<span style="color:#e6db74">&#34;imdb_best.stan&#34;</span>), 
           <span style="color:#75715e"># Make a list of data to send to Stan</span>
           data <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(N <span style="color:#f92672">=</span> <span style="color:#a6e22e">nrow</span>(movies_clean), 
                       n_groups <span style="color:#f92672">=</span> <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(movies_clean<span style="color:#f92672">$</span>genre)), 
                       group_id <span style="color:#f92672">=</span> movies_clean<span style="color:#f92672">$</span>genre_numeric, 
                       y <span style="color:#f92672">=</span> movies_clean<span style="color:#f92672">$</span>rating),
           chains <span style="color:#f92672">=</span> CHAINS, iter <span style="color:#f92672">=</span> ITER, warmup <span style="color:#f92672">=</span> WARMUP, seed <span style="color:#f92672">=</span> BAYES_SEED)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">stan_best_tidy <span style="color:#f92672">&lt;-</span> 
  <span style="color:#a6e22e">tidyMCMC</span>(stan_best, conf.int <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, conf.level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.95</span>, 
           estimate.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;median&#34;</span>, conf.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HPDinterval&#34;</span>)
stan_best_tidy

<span style="color:#75715e">## # A tibble: 8 x 5</span>
<span style="color:#75715e">##   term     estimate std.error conf.low conf.high</span>
<span style="color:#75715e">##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 mu[1]       5.29     0.108     5.09      5.50 </span>
<span style="color:#75715e">## 2 mu[2]       5.99     0.104     5.79      6.19 </span>
<span style="color:#75715e">## 3 sigma[1]    1.47     0.0838    1.30      1.63 </span>
<span style="color:#75715e">## 4 sigma[2]    1.47     0.0885    1.30      1.65 </span>
<span style="color:#75715e">## 5 nu         29.0     20.1       6.35     76.2  </span>
<span style="color:#75715e">## 6 mu_diff    -0.693    0.147    -0.992    -0.422</span>
<span style="color:#75715e">## 7 cohen_d    -0.573    0.123    -0.825    -0.349</span>
<span style="color:#75715e">## 8 cles        0.343    0.0318    0.280     0.402</span>
</code></pre></div><p>One advantage of running the analysis with raw Stan instead of forcing it into regression form is that we can have Stan calculate all sorts of stuff for us. The averages for both groups get returned (<code>mu[1]</code> and <code>mu[2]</code>), along with <code>mu_diff</code>, so there&rsquo;s no need to combine slope and intercept terms. Also note how the <code>sigma</code> coefficients are already in the right scale. I also (following Kruschke and others) made it so that the Stan code returned information about effect sizes, including <a href="https://en.wikipedia.org/wiki/Effect_size#Cohen's_d">Cohen&rsquo;s d</a>, which is the standardized difference in means, and the <a href="https://janhove.github.io/reporting/2016/11/16/common-language-effect-sizes">common language effect size (CLES)</a>, which is the probability that a rating sampled at random from one group will be greater than a rating sampled from the other group.</p>
<p>Here, the difference in means is the same as all the other methods, but the effect size isn’t terribly huge. According to Cohen’s d, we have a medium effect size, and there’s a 34% chance that we could randomly select an action rating from the comedy distribution.</p>
<h2 id="regression-best-with-priors-on-variables-instead-of-difference">Regression, BEST, with priors on variables instead of difference</h2>
<p><em>(I added this section later)</em></p>
<p>In the Twitter discussion that followed this post, <a href="https://mikedecr.github.io/">Mike DeCrescenzo</a> made a <a href="https://twitter.com/mikedecr/status/1090416939917340672">fascinating point</a> that relying on regression for t-test-like analysis with Bayesianism actually has important theoretical implications.</p>
<p>When specifying a model as <code>y ~ a + bx</code> as we did above with <code>rating ~ genre</code>, the coefficient for genre (<code>b</code>) is actually the difference in means and doesn’t directly reflect the rating itself. In theory, if
we’re thinking about two groups with two different variances, we should model the distribution of each group, not the distribution of the differences in groups. Analyzing the distributions of the two groups separately and <em>then</em> calculating the difference should yield more transparent results. Plus it’s easier to think about setting priors on two variables that were measured in real life (e.g. ratings for comedies and action movies), rather than setting priors on whatever the difference between those looks like.</p>
<p>The raw Stan code above does this correctly by feeding two groups into the model rather than the difference in means. <a href="https://twitter.com/tjmahr/status/1090417050600816641?s=21">TJ Mahr</a> and <a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse">Solomon Kurz’s translation of Kruschke’s code into <strong>brms</strong></a> (<a href="https://github.com/ASKurz/Doing-Bayesian-Data-Analysis-in-brms-and-the-tidyverse/blob/master/16.Rmd">see near the bottom of chapter 16</a>) both show that we can do this with <strong>brms</strong> by changing the formula slightly. If we suppress the intercept by running a model like <code>ratiing ~ 0 + genre</code>, <strong>brms</strong> returns coefficients for each of the groups (no more base case!), and these coefficients represent group means.</p>
<p>Here’s an intercept-free version of the <strong>brms</strong>-based BEST regression from earlier. Note how we’re modeling both the rating and the group sigmas without intercepts (<code>rating ~ 0 + genre, sigma ~ 0 + genre</code>), and that we no longer specify a prior for the intercept (if we do, <code>brm()</code> yells at us). Also note that instead of modeling the beta coefficient as a normal distribution centered around zero (since that represented the difference in means), we specify the distribution of action and comedy ratings themselves. Because we’re dealing with actual ratings, we can make them fairly well informed and constrained. For instance, no movie is rated below 1 or above 10, and I’m guessing from past experience looking at ratings on Amazon and IMDB and elsewhere that people tend to inflate their ratings. I’d guess that the distribution of ratings looks something like this: normally distributed with a mean of 6, standard deviation of 2, and truncated at 1 and 10.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Cool extra thing I discovered: the msm library has rtnorm, dtnorm, and family</span>
<span style="color:#75715e"># which let you plot and draw from a truncated normal distribution</span>
<span style="color:#75715e"># msm::rtnorm(1000, mean = 6, sd = 2, lower = 1, upper = 10)</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> <span style="color:#a6e22e">tibble</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">10</span>)), <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">stat_function</span>(fun <span style="color:#f92672">=</span> dnorm, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">500</span>, args <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(mean <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>, sd <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;normal(6, 2); truncated at 1 and 10&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>()
</code></pre></div><figure class="img-75"><img src="dist-ratings-1.png"
         alt="Normal distribution, truncated"/>
</figure>

<p>Now we can run the model like normal:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_uneq_robust_groups <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">brm</span>(
  <span style="color:#a6e22e">bf</span>(rating <span style="color:#f92672">~</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">+</span> genre, sigma <span style="color:#f92672">~</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">+</span> genre), 
  family <span style="color:#f92672">=</span> student,
  data <span style="color:#f92672">=</span> <span style="color:#a6e22e">mutate</span>(movies_clean, genre <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_rev</span>(genre)),
  prior <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(
    <span style="color:#75715e"># Set group mean prior</span>
    <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;normal(6, 2)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;b&#34;</span>, lb <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, ub <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>),
    <span style="color:#75715e"># Ser group variance priors. We keep the less informative cauchy(0, 1).</span>
    <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;cauchy(0, 1)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;b&#34;</span>, dpar <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sigma&#34;</span>),
    <span style="color:#a6e22e">set_prior</span>(<span style="color:#e6db74">&#34;exponential(1.0/29)&#34;</span>, class <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;nu&#34;</span>)),
  chains <span style="color:#f92672">=</span> CHAINS, iter <span style="color:#f92672">=</span> ITER, warmup <span style="color:#f92672">=</span> WARMUP, seed <span style="color:#f92672">=</span> BAYES_SEED,
  file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;cache/brms_uneq_robust_groups&#34;</span>
)
</code></pre></div><p>We still need to exponentiate the sigma coefficients when we’re done.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_uneq_robust_groups_tidy <span style="color:#f92672">&lt;-</span> 
  <span style="color:#a6e22e">tidyMCMC</span>(brms_uneq_robust_groups, conf.int <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, conf.level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.95</span>, 
           estimate.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;median&#34;</span>, conf.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HPDinterval&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># Rescale sigmas</span>
  <span style="color:#a6e22e">mutate_at</span>(<span style="color:#a6e22e">vars</span>(estimate, std.error, conf.low, conf.high),
            <span style="color:#a6e22e">funs</span>(<span style="color:#a6e22e">ifelse</span>(<span style="color:#a6e22e">str_detect</span>(term, <span style="color:#e6db74">&#34;sigma&#34;</span>), <span style="color:#a6e22e">exp</span>(.), .)))
brms_uneq_robust_groups_tidy

<span style="color:#75715e">## # A tibble: 5 x 5</span>
<span style="color:#75715e">##   term                estimate std.error conf.low conf.high</span>
<span style="color:#75715e">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 b_genreComedy           5.99     0.109     5.77      6.19</span>
<span style="color:#75715e">## 2 b_genreAction           5.30     0.107     5.09      5.50</span>
<span style="color:#75715e">## 3 b_sigma_genreComedy     1.47     1.06      1.30      1.65</span>
<span style="color:#75715e">## 4 b_sigma_genreAction     1.47     1.06      1.31      1.62</span>
<span style="color:#75715e">## 5 nu                     29.9     28.1       6.00     92.7</span>
</code></pre></div><p>Because we calculated the group means themselves, we need to do an extra few steps to get the difference in means. It’s fairly easy: we extract the posterior samples for each of the groups, subtract them from each other, and then calculate the credible interval.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">brms_uneq_robust_groups_post <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">posterior_samples</span>(brms_uneq_robust_groups) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># We can exponentiate here!</span>
  <span style="color:#a6e22e">mutate_at</span>(<span style="color:#a6e22e">vars</span>(<span style="color:#a6e22e">contains</span>(<span style="color:#e6db74">&#34;sigma&#34;</span>)), <span style="color:#a6e22e">funs</span>(exp)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># For whatever reason, we need to log nu?</span>
  <span style="color:#a6e22e">mutate</span>(nu <span style="color:#f92672">=</span> <span style="color:#a6e22e">log10</span>(nu)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(diff_means <span style="color:#f92672">=</span> b_genreAction <span style="color:#f92672">-</span> b_genreComedy,
         diff_sigma <span style="color:#f92672">=</span> b_sigma_genreAction <span style="color:#f92672">-</span> b_sigma_genreComedy) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#75715e"># Calculate effect sizes, just for fun</span>
  <span style="color:#a6e22e">mutate</span>(cohen_d <span style="color:#f92672">=</span> diff_means <span style="color:#f92672">/</span> <span style="color:#a6e22e">sqrt</span>((b_sigma_genreAction <span style="color:#f92672">+</span> b_sigma_genreComedy)<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>),
         cles <span style="color:#f92672">=</span> <span style="color:#a6e22e">dnorm</span>(diff_means <span style="color:#f92672">/</span> <span style="color:#a6e22e">sqrt</span>((b_sigma_genreAction <span style="color:#f92672">+</span> b_sigma_genreComedy)), <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>))

brms_uneq_robust_groups_tidy_fixed <span style="color:#f92672">&lt;-</span> 
  <span style="color:#a6e22e">tidyMCMC</span>(brms_uneq_robust_groups_post, conf.int <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, conf.level <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.95</span>, 
           estimate.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;median&#34;</span>, conf.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;HPDinterval&#34;</span>)
brms_uneq_robust_groups_tidy_fixed

<span style="color:#75715e">## # A tibble: 9 x 5</span>
<span style="color:#75715e">##   term                estimate std.error conf.low conf.high</span>
<span style="color:#75715e">##   &lt;chr&gt;                  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span style="color:#75715e">## 1 b_genreComedy        5.99       0.109     5.77      6.19 </span>
<span style="color:#75715e">## 2 b_genreAction        5.30       0.107     5.09      5.50 </span>
<span style="color:#75715e">## 3 b_sigma_genreComedy  1.47       0.0882    1.30      1.64 </span>
<span style="color:#75715e">## 4 b_sigma_genreAction  1.47       0.0826    1.31      1.62 </span>
<span style="color:#75715e">## 5 nu                   1.48       0.287     0.963     2.04 </span>
<span style="color:#75715e">## 6 diff_means          -0.690      0.151    -1.01     -0.415</span>
<span style="color:#75715e">## 7 diff_sigma           0.00100    0.111    -0.212     0.217</span>
<span style="color:#75715e">## 8 cohen_d             -0.571      0.126    -0.818    -0.327</span>
<span style="color:#75715e">## 9 cles                 0.368      0.0132    0.341     0.391</span>
</code></pre></div><p>And voila! Difference in means based on priors on individual group means rather than differences in groups!</p>
<h2 id="comparing-all-methods">Comparing all methods</h2>
<p>Holy cow, that’s a lot of code. We can compare the output from all these different methods in a single plot. In this case, since both groups are pretty normally distributed already and there were no outliers, there isn’t much variation at all in the results—all the different methods show essentially the same thing. We can legally interpret the Bayesian results using credible intervals and probabilities; with the classical t-tests, we still have to talk about null hypotheses. But in the end, the results are nearly identical (but that’s definitely not always the case).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Make a bunch of data frames that have three columns: </span>
<span style="color:#75715e"># estimate, conf.low, and conf.high</span>

<span style="color:#75715e"># Extract t-test results</span>
t_test_eq_small <span style="color:#f92672">&lt;-</span> t_test_eq_tidy <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(estimate, conf.low, conf.high)

t_test_uneq_small <span style="color:#f92672">&lt;-</span> t_test_uneq_tidy <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(estimate, conf.low, conf.high)

<span style="color:#75715e"># Extract simulation results</span>
infer_simulation <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tibble</span>(estimate <span style="color:#f92672">=</span> diff_means<span style="color:#f92672">$</span>stat,
                           conf.low <span style="color:#f92672">=</span> boostrapped_confint<span style="color:#f92672">$</span>`2.5%`,
                           conf.high <span style="color:#f92672">=</span> boostrapped_confint<span style="color:#f92672">$</span>`97.5%`)

<span style="color:#75715e"># Extract brms regression results</span>
brms_eq_small <span style="color:#f92672">&lt;-</span> brms_eq_tidy <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(term <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;b_genreAction&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(estimate, conf.low, conf.high)

brms_uneq_small <span style="color:#f92672">&lt;-</span> brms_uneq_tidy <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(term <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;b_genreAction&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(estimate, conf.low, conf.high)

brms_uneq_robust_small <span style="color:#f92672">&lt;-</span> brms_uneq_robust_tidy <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(term <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;b_genreAction&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(estimate, conf.low, conf.high)

brms_uneq_robust_groups_small <span style="color:#f92672">&lt;-</span> brms_uneq_robust_groups_tidy_fixed <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(term <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;diff_means&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(estimate, conf.low, conf.high)

<span style="color:#75715e"># Extract Stan results</span>
stan_best_small <span style="color:#f92672">&lt;-</span> stan_best_tidy <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">filter</span>(term <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mu_diff&#34;</span>) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">select</span>(estimate, conf.low, conf.high)

<span style="color:#75715e"># Put all these mini dataframes into a list column, then unnest</span>
meta_diffs <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tribble</span>(
  <span style="color:#f92672">~</span>package, <span style="color:#f92672">~</span>method, <span style="color:#f92672">~</span>results,
  <span style="color:#e6db74">&#34;t-test&#34;</span>, <span style="color:#e6db74">&#34;equal variances&#34;</span>, t_test_eq_small,
  <span style="color:#e6db74">&#34;t-test&#34;</span>, <span style="color:#e6db74">&#34;unequal variances&#34;</span>, t_test_uneq_small,
  <span style="color:#e6db74">&#34;infer&#34;</span>, <span style="color:#e6db74">&#34;simulation&#34;</span>, infer_simulation,
  <span style="color:#e6db74">&#34;brms&#34;</span>, <span style="color:#e6db74">&#34;equal variances&#34;</span>, brms_eq_small,
  <span style="color:#e6db74">&#34;brms&#34;</span>, <span style="color:#e6db74">&#34;unequal variances&#34;</span>, brms_uneq_small,
  <span style="color:#e6db74">&#34;brms&#34;</span>, <span style="color:#e6db74">&#34;BEST&#34;</span>, brms_uneq_robust_small,
  <span style="color:#e6db74">&#34;brms&#34;</span>, <span style="color:#e6db74">&#34;BEST; group means&#34;</span>, brms_uneq_robust_groups_small,
  <span style="color:#e6db74">&#34;Stan&#34;</span>, <span style="color:#e6db74">&#34;BEST&#34;</span>, stan_best_small
) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">unnest</span>(results) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(method <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(package, <span style="color:#e6db74">&#34;: &#34;</span>, method)) <span style="color:#f92672">%&gt;%</span> 
  <span style="color:#a6e22e">mutate</span>(method <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_inorder</span>(method))

<span style="color:#a6e22e">ggplot</span>(meta_diffs, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> estimate, y <span style="color:#f92672">=</span> <span style="color:#a6e22e">fct_rev</span>(method), color <span style="color:#f92672">=</span> package)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_pointrangeh</span>(<span style="color:#a6e22e">aes</span>(xmin <span style="color:#f92672">=</span> conf.low, xmax <span style="color:#f92672">=</span> conf.high), size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_color_viridis_d</span>(option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;plasma&#34;</span>, end <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.9</span>, guide <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Mean rating for action movies − mean rating for comedies&#34;</span>,
       y <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, caption <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Sample of 400 movies from IMDB&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Comedies get higher ratings than action movies&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Effect is roughly the same regardless of method used&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">expand_limits</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_fancy</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(face <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bold&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#a6e22e">rel</span>(<span style="color:#ae81ff">1.5</span>)))
</code></pre></div><p><img src="compare-everything-1.png" alt="Comparison of all methods"></p>

    
        <footer>
            <div class="tags">
    <i class="fas fa-tags" aria-hidden="true"></i>&ensp;
    <a href="/blog/tags/r/">r</a>
    <span class="separator">•</span>
    <a href="/blog/tags/ggplot/">ggplot</a>
    <span class="separator">•</span>
    <a href="/blog/tags/tidyverse/">tidyverse</a>
    <span class="separator">•</span>
    <a href="/blog/tags/stan/">stan</a>
    <span class="separator">•</span>
    <a href="/blog/tags/bayes/">bayes</a></div>

        </footer>

        <div id="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                 
                var disqus_shortname = 'andrewheisscom';
                var disqus_title = document.title;
                var disqus_url = 'https:\/\/www.shagunjhaver.com\/blog\/2019\/01\/29\/diff-means-half-dozen-ways\/';

                 
                (function () {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
                    Disqus.</a></noscript>
        </div>
    </article>
</section>

  

<script src="/js/math-code.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>
<script>
    MathJax = {
        tex: {
            inlineMath: [
                ['$', '$'], ['\\(', '\\)']
            ],
            processEscapes: true,
            processEnvironments: true
        },
        options: {
            skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        }
    };
</script>

        </div> 
    </div> 
    
    <div id="footer">
        <footer>
    <ul class="links">
        <li>
            <a href="mailto:shagun.jhaver@rutgers.edu" aria-label="E-mail"   >
                <i class="fa fa-envelope" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://medium.com/@shagunjhaver" aria-label="Medium"   >
                <i class="fab fa-medium" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://scholar.google.com/citations?user=OgtKT6UAAAAJ" aria-label="Google Scholar"   >
                <i class="ai ai-google-scholar" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://dl.acm.org/author_page.cfm?id=99658987207" aria-label="ACM Digital Library"   >
                <i class="ai ai-acmdl-square" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://github.com/shaguniitb" aria-label="GitHub"   >
                <i class="fab fa-github" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://twitter.com/shagunjhaver" aria-label="Twitter"   >
                <i class="fab fa-twitter" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://www.facebook.com/shagun.jhaver" aria-label="Facebook"   >
                <i class="fab fa-facebook" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/in/shagun-jhaver/" aria-label="LinkedIn"   >
                <i class="fab fa-linkedin" aria-hidden="true"></i>
            </a>
        </li>
    </ul>

    <p class="colophon"> <i class="fas fa-map-marker-alt"></i> New Brunswick, NJ </p>
    <p class="colophon">ORCID iD: <a href="https://orcid.org/0000-0002-6728-7101">0000-0002-6728-7101</a></p>

   <p class="colophon">
    This site is a derivative of <a href="https://github.com/andrewheiss/ath-hugo">ath-hugo</a> by Andrew Heiss, used under CC <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">4.0</a>.
   </p>


    <p class="colophon"><a href="https://github.com/shaguniitb/ath-hugo">Code for site</a></p>
</footer>

    </div>

</body>

</html>
