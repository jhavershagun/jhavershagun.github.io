<!DOCTYPE html>
<html lang="en"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Andrew Heiss">
    <meta name="description" content="Create a macOS Automator service to convert Markdown to rich text from any app in macOS">
    <meta name="keywords" content="pandoc, macos">
    <meta name="generator" content="Hugo 0.88.1" />

    <title>
  Convert Markdown to rich text (with syntax highlighting!) in any macOS app | Andrew Heiss
</title>

    <link rel="canonical" href="https://www.andrewheiss.com/blog/2019/10/09/convert-md-rtf-macos-services/">
    <link rel="alternate" type="application/atom+xml" title="Blog Posts" href="https://www.andrewheiss.com/atom.xml">
    <link rel="alternate" type="application/json" title="JSON Feed" href="https://www.andrewheiss.com/feed.json">

    <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud?source=profiles">
    <link rel="openid2.local_id" href="https://www.google.com/profiles/andrewheiss">

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://www.andrewheiss.com/profiles/twitter-card-large.png?v=1"/>
    <meta name="twitter:site" content="@andrewheiss"/>
    <meta name="twitter:title" content="Convert Markdown to rich text (with syntax highlighting!) in any macOS app"/>
    <meta name="twitter:creator" content="@andrewheiss"/>
    <meta name="twitter:description" content="Create a macOS Automator service to convert Markdown to rich text from any app in macOS"/>


    <meta property="og:title" content="Convert Markdown to rich text (with syntax highlighting!) in any macOS app" />
<meta property="og:description" content="Create a macOS Automator service to convert Markdown to rich text from any app in macOS" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.andrewheiss.com/blog/2019/10/09/convert-md-rtf-macos-services/" />
<meta property="og:image" content="https://www.andrewheiss.com/profiles/twitter-card-large.png"/>
<meta property="article:published_time" content="2019-10-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-10-09T00:00:00+00:00" />

<meta property="article:author" content="https://www.facebook.com/andrewheiss" />
<meta property="article:publisher" content="https://www.facebook.com/andrewheiss" />
<meta property="article:section" content="blog" />
<meta property="article:tag" content="pandoc" />
<meta property="article:tag" content="macos" />


    <meta itemprop="name" content="Convert Markdown to rich text (with syntax highlighting!) in any macOS app">
<meta itemprop="description" content="Create a macOS Automator service to convert Markdown to rich text from any app in macOS"><meta itemprop="datePublished" content="2019-10-09T00:00:00+00:00" />
<meta itemprop="dateModified" content="2019-10-09T00:00:00+00:00" />
<meta itemprop="wordCount" content="1185"><meta itemprop="image" content="https://www.andrewheiss.com/profiles/twitter-card-large.png"/>
<meta itemprop="keywords" content="pandoc,macos," />

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/pure-and-grids-responsive.min.css">
    <link rel="stylesheet" href="/css/ath-hugo.min.c5619237d890aa972042ca0497d2594d6f3f34b1746c377f560f5096573fb6e3.css" integrity="sha256-xWGSN9iQqpcgQsoEl9JZTW8/NLF0bDd/Vg9Qllc/tuM=" crossorigin="anonymous" media="screen" />

    <script src="https://kit.fontawesome.com/f9d343c40d.js" crossorigin="anonymous"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=dLX2MbQJLG">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=dLX2MbQJLG">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=dLX2MbQJLG">
    <link rel="manifest" href="/site.webmanifest?v=dLX2MbQJLG">
    <link rel="mask-icon" href="/safari-pinned-tab.svg?v=dLX2MbQJLG" color="#cf4446">
    <link rel="shortcut icon" href="/favicon.ico?v=dLX2MbQJLG">
    <meta name="msapplication-TileColor" content="#170c3a">
    <meta name="theme-color" content="#170c3a">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-527449-5', 'auto');
      ga('send', 'pageview');
    </script>
</head>

<body>

    <div id="layout" class="pure-g">
        <div id="sidebar" class="pure-u-1 pure-u-md-1-4">
            <header>
                <h1 class="title"><a href="/">Andrew Heiss</a></h1>
                <h2 class="minibio">International NGOs, nonprofit management, authoritarianism, data science, and R</h2>

                <nav id="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a class="nav-link" href="/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cv/">CV</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/blog/">Blog</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/research/">Research</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/teaching/">Teaching</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/talks/">Talks</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/now/">Now</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/uses/">Uses</a>
                        </li>
                    </ul>
                </nav>
            </header>

        </div> 
    
        <div id="content" class="pure-u-1 pure-u-md-3-4">
        
  <section>
    <article class="content-single">
        <header class="post-header">
            <h1 class="post-title">Convert Markdown to rich text (with syntax highlighting!) in any macOS app</h1>

            <div class="post-meta pure-g">
                <div class="pure-u-1-2">
                    <span class="posted-on">
                        <i class="far fa-calendar-alt" aria-hidden="true"></i>
                        <time datetime='2019-10-09T00:00:00Z'>
                            Wednesday, October 9, 2019
                        </time>
                    </span>
                </div>
                <div class="reading-time pure-u-1-2">
                    <i class="far fa-clock" aria-hidden="true"></i>
                    6-minute read
                </div>
            </div>
        </header>
    
        <p>GSU uses Microsoft&rsquo;s Office365 for e-mail, which is fine. My previous institutions—Duke and BYU—both use it too, and it&rsquo;s pretty standard. GSU also enforces 2-factor authentication (2FA) with Duo, which is also fine. Everybody should use some sort of 2FA for all their important accounts!</p>
<p>However, for whatever reason, GSU&rsquo;s version of Duo&rsquo;s 2FA doesn&rsquo;t allow you to generate app-specific passwords for things like e-mail. Instead, any e-mail client I use has to have support for Microsoft&rsquo;s special <a href="https://docs.microsoft.com/en-us/office365/enterprise/office-365-client-support-modern-authentication">Modern Authentication</a> system, which opens up a popup window to handle the 2FA and logging in and everything. The issue with this is that very few e-mail clients support Modern Authentication. In the macOS world, the only program that supports it is Apple Mail. That&rsquo;s all.</p>
<p>This means I&rsquo;ve had to move away from my favorite e-mail client ever: <a href="https://airmailapp.com/">Airmail</a>. Airmail is fast, looks nice, and has great search features. Most importantly for me, though, is that it let you write e-mails in Markdown and then converted the Markdown text to HTML when you clicked send. This is the coolest thing ever if you use Markdown everywhere normally, but it&rsquo;s even better when teaching code-heavy classes. I could respond to student questions by typing stuff like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Oh, I see! You have an error in the 3rd line there. Try changing it to:

```r
ggplot(mtcars, aes(x = wt, y = mpg)) +
  geom_point() +
  theme_bw()
```
</code></pre></div><p>…and Airmail would convert that to nicely formatted HTML. So convenient!</p>
<p>Apple Mail can&rsquo;t do this.</p>
<p>However, through the magic of macOS services, Bash scripting, and AppleScript, I&rsquo;ve found a way to convert Markdown text to richly formatted text, and it&rsquo;s delightful!</p>
<p>Here&rsquo;s how to do it.</p>
<h2 id="macos-services">macOS services</h2>
<p>macOS comes with Automator, a program that lets you create workflows for repeated tasks. One kind of workflow is called a Service (or Quick Action), which can take text (or a file), do stuff to it, and spit out new text. Here&rsquo;s a super basic example that takes selected text, converts it to uppercase with the <code>tr</code> bash command, copies it to the system-wide clipboard using the <code>pbcopy</code> shell script, gets the contents of the clipboard, and then replaces the selected text:</p>
<p><img src="make-uppercase.png" alt="Workflow to make text uppercase"></p>
<p>If you save this as a Quick Action, macOS will put it in a folder named <code>~/Library/Services</code>. Once it&rsquo;s there, it&rsquo;ll be accessible in any program that lets you type, like TextEdit or Mail. Type some text in TextEdit, select it, and go to the TextEdit → Services menu. You should see the &ldquo;Make uppercase&rdquo; service. If you click on it, your text will be converted to uppercase. Magic.</p>
<p><img src="services-menu.png" alt="Services menu in TextEdit"></p>
<p>You can make these easier to run by assigning them keyboard shortcuts. Go to System Preferences → Keyboard → Shortcuts → Services, scroll down the list until you find the &ldquo;Make uppercase&rdquo; service, and add a shortcut for it. Now you can convert text to upper case in any application by selecting it and pressing the keyboard shortcut. Super magic.</p>
<p><img src="add-shortcut.png" alt="Assigning a keyboard shortcut to a service"></p>
<h2 id="markdown-to-rtf-basic">Markdown to RTF, basic</h2>
<p>Rather than converting text to uppercase, we can make a service that pipes Markdown text through <a href="https://pandoc.org">pandoc</a>, converts it to nicely styled RTF, and replaces the selected text with the nicely styled text.</p>
<p>Make a new Quick Action in Automator that looks like this (I named it <strong>md2rtf</strong>):</p>
<p><img src="workflow-simple.png" alt="Simple md2rtf workflow"></p>
<p>The shell script should look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># !/bin/bash</span>
export LC_CTYPE<span style="color:#f92672">=</span>UTF-8
/usr/local/bin/pandoc -t rtf -s | pbcopy
</code></pre></div><p>This will run your text through pandoc, convert it to RTF, and copy the results to the clipboard. The &ldquo;Get Contents of Clipboard&rdquo; will then grab the formatted text from the clipboard and replace the selected text with it.</p>
<p>Watch it in action here:</p>
<iframe src="https://player.vimeo.com/video/365343785" width="640" height="457" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
<p>With this service, I can type in Markdown in Mail, convert it all to rich text, and then send, which is really convenient!</p>
<h2 id="markdown-to-rtf-with-syntax-highlighting">Markdown to RTF, with syntax highlighting</h2>
<p>However, it&rsquo;s not quite perfect. RTF doesn&rsquo;t support syntax highlighting, so if I convert any code, it&rsquo;ll format it in monospaced Courier font (which is good!) that is just plain black (which is less good!). HTML output does support syntax highlighting, though, so it&rsquo;d be nice if there was a way to take Markdown text and replace it with converted HTML.</p>
<p>Just changing the pandoc script to <code>/usr/local/bin/pandoc -t html -s | pbcopy</code> won&rsquo;t work, though. It&rsquo;ll convert the file to HTML, as expected, but it&rsquo;ll replace your text with all the HTML tags instead of rendered HTML, which is less than ideal.</p>
<p><img src="wrong-html.png" alt="Incorrect unrendered raw HTML"></p>
<p>So instead, we need to convert to HTML, somehow render that HTML to rich text, and then replace the text with that instead. Fortunately someone asked a <a href="https://stackoverflow.com/a/11089226">similar question on StackOverflow in 2012</a>, and there&rsquo;s a solution we can adapt! We basically convert HTML to raw hex code, then convert the hex code to HTML with AppleScript, which renders the HTML correctly. It seems (and is) convoluted, but it works!</p>
<p>Change the shell script in the Automator workflow to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># !/bin/bash</span>
export LC_CTYPE<span style="color:#f92672">=</span>UTF-8
hex<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>/usr/local/bin/pandoc -t html -s --highlight-style pygments | hexdump -ve <span style="color:#e6db74">&#39;1/1 &#34;%.2x&#34;&#39;</span><span style="color:#e6db74">`</span>
osascript -e <span style="color:#e6db74">&#34;set the clipboard to «data HTML</span><span style="color:#e6db74">${</span>hex<span style="color:#e6db74">}</span><span style="color:#e6db74">»&#34;</span>
</code></pre></div><p><img src="workflow-better.png" alt="Better md2rtf workflow"></p>
<p>This will take the selected text, convert it to HTML, convert the raw HTML to hex codes, convert the hex code to <em>rendered</em> HTML, and replace the selected text with that.</p>
<p>Here&rsquo;s what it looks like:</p>
<iframe src="https://player.vimeo.com/video/365343809" width="640" height="466" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
<p>This is almost perfect! The only minor issue is that the non-code text switched from Helvetica (TextEdit&rsquo;s and Apple Mail&rsquo;s default) to Times New Roman, which isn&rsquo;t great. It&rsquo;d be fantastic if the converted HTML used Helvetica instead of Times.</p>
<p>Fortunately there&rsquo;s a way to fix that. The text is getting converted to Times because the rendered HTML defaults to Times in the absence of any CSS styles telling it to be something else. If we can insert some custom CSS into the converted HTML file with pandoc, we should be able to get the correct font.</p>
<p>There&rsquo;s an argument for pandoc that lets you insert files into the head of the HTML, <code>-H</code>. (There&rsquo;s also a <code>--css</code> argument, but <a href="https://devilgate.org/blog/2012/07/02/tip-using-pandoc-to-create-truly-standalone-html-files/">it doesn&rsquo;t play well with standalone HTML files</a>, so it&rsquo;s easier to insert stuff directly into the converted HTML). Create an HTML file somewhere on your computer with this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">style</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/css&#34;</span>&gt;
<span style="color:#f92672">body</span> {
    <span style="color:#66d9ef">font-family</span>: Helvetica, <span style="color:#66d9ef">sans-serif</span>;
}
&lt;/<span style="color:#f92672">style</span>&gt;
</code></pre></div><p>(This isn&rsquo;t raw CSS—it&rsquo;s CSS wrapped in HTML. We have to do that because pandoc will take that whole file and insert it as HTML in the converted document, so we have to treat it as HTML.)</p>
<p>Change your Automator workflow one last time so that it injects the custom CSS:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># !/bin/bash</span>
export LC_CTYPE<span style="color:#f92672">=</span>UTF-8
hex<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>/usr/local/bin/pandoc -t html -s --highlight-style pygments -H ~/path/to/your/css/thing/md2rtf_styles.html | hexdump -ve <span style="color:#e6db74">&#39;1/1 &#34;%.2x&#34;&#39;</span><span style="color:#e6db74">`</span>
osascript -e <span style="color:#e6db74">&#34;set the clipboard to «data HTML</span><span style="color:#e6db74">${</span>hex<span style="color:#e6db74">}</span><span style="color:#e6db74">»&#34;</span>
</code></pre></div><p><img src="workflow-best.png" alt="Best md2rtf workflow"></p>
<p>With that addition, the workflow will now take your selected text, convert it to HTML that is styled with Helvetica, convert <em>that</em> to hex code, convert <em>that</em> to rendered HTML, and finally replace your text with impeccable style:</p>
<iframe src="https://player.vimeo.com/video/365343828" width="640" height="471" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>
<p>I&rsquo;ve added <strong>⌘⌥^⇧P</strong> as the shortcut for this (so I essentially mash down the whole bottom left corner of my keyboard and hit P), and it makes using Apple Mail with Markdown and code quite convenient!</p>

    
        <footer>
            <div class="tags">
    <i class="fas fa-tags" aria-hidden="true"></i>&ensp;
    <a href="/blog/tags/pandoc/">pandoc</a>
    <span class="separator">•</span>
    <a href="/blog/tags/macos/">macos</a></div>

        </footer>

        <div id="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                 
                var disqus_shortname = 'andrewheisscom';
                var disqus_title = document.title;
                var disqus_url = 'https:\/\/www.andrewheiss.com\/blog\/2019\/10\/09\/convert-md-rtf-macos-services\/';

                 
                (function () {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
                    Disqus.</a></noscript>
        </div>
    </article>
</section>

  

        </div> 
    </div> 
    
    <div id="footer">
        <footer>
    <ul class="links">
        <li>
            <a href="mailto:aheiss@gsu.edu" aria-label="E-mail"   >
                <i class="fa fa-envelope" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://twitter.com/andrewheiss" aria-label="Twitter"   >
                <i class="fab fa-twitter" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://github.com/andrewheiss" aria-label="GitHub"   >
                <i class="fab fa-github" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://www.youtube.com/andrewheiss" aria-label="YouTube"   >
                <i class="fab fa-youtube" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://stackoverflow.com/users/120898/andrew" aria-label="StackOverflow"   >
                <i class="fab fa-stack-overflow" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://www.heissatopia.com" aria-label="Heissatopia (family blog)"   >
                <i class="fab fa-blogger" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://www.facebook.com/andrewheiss" aria-label="Facebook"   >
                <i class="fab fa-facebook" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/in/andrewheiss" aria-label="LinkedIn"   >
                <i class="fab fa-linkedin" aria-hidden="true"></i>
            </a>
        </li>
    </ul>

    <p class="colophon">ORCID iD: <a href="https://orcid.org/0000-0002-3948-3914">0000-0002-3948-3914</a></p>

    <p class="pgp">
        <a href="https://www.andrewheiss.com/pgp_ath.asc.txt">PGP public <i class="fas fa-key" aria-hidden="true"></i></a> &bull; PGP
        fingerprint:<br />4AA2 FA83 A8B2 05A4 E30F<br /> 610D 1382 6216 9178 36AB
    </p>

    <p class="copyright">
        <a href="http://creativecommons.org/licenses/by-sa/4.0/"
            title="Creative Commons Attribution-ShareAlike 4.0 International license"><i class="fab fa-creative-commons"></i>
        <i class="fab fa-creative-commons-by" title="Attribution"></i>
        <i class="fab fa-creative-commons-share" title="Share alike"></i></a>
        <span class="cc-year">&bull; 2007&ndash;2021</span>
    </p>

    <p class="colophon"><a href="https://github.com/andrewheiss/ath-hugo">Code for site</a></p>
</footer>

    </div>

</body>

</html>
