<!DOCTYPE html>
<html lang="en"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Shagun Jhaver">
    <meta name="description" content="Use ggplot to create economics-style, non-data-based conceptual graphs.">
    <meta name="keywords" content="r, ggplot, dataviz, economics">
    <meta name="generator" content="Hugo 0.88.1" />

    <title>
  Create supply and demand economics curves with ggplot2 | Shagun Jhaver
</title>

    <link rel="canonical" href="https://www.shagunjhaver.com/blog/2017/09/15/create-supply-and-demand-economics-curves-with-ggplot2/">
    <link rel="alternate" type="application/atom+xml" title="Blog Posts" href="https://www.shagunjhaver.com/atom.xml">
    <link rel="alternate" type="application/json" title="JSON Feed" href="https://www.shagunjhaver.com/feed.json">

    <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud?source=profiles">
    <link rel="openid2.local_id" href="https://www.google.com/profiles/andrewheiss">

    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://www.shagunjhaver.com/blog/2017/09/15/create-supply-and-demand-economics-curves-with-ggplot2/complete-example-1.png"/>
    <meta name="twitter:site" content="@shagunjhaver"/>
    <meta name="twitter:title" content="Create supply and demand economics curves with ggplot2"/>
    <meta name="twitter:creator" content="@shagunjhaver"/>
    <meta name="twitter:description" content="Use ggplot to create economics-style, non-data-based conceptual graphs."/>


    <meta property="og:title" content="Create supply and demand economics curves with ggplot2" />
<meta property="og:description" content="Use ggplot to create economics-style, non-data-based conceptual graphs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.shagunjhaver.com/blog/2017/09/15/create-supply-and-demand-economics-curves-with-ggplot2/" />
<meta property="og:image" content="https://www.shagunjhaver.com/blog/2017/09/15/create-supply-and-demand-economics-curves-with-ggplot2/complete-example-1.png" />
<meta property="article:published_time" content="2017-09-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-09-15T00:00:00+00:00" />

<meta property="article:author" content="https://www.facebook.com/shagun.jhaver" />
<meta property="article:publisher" content="https://www.facebook.com/shagun.jhaver" />
<meta property="article:section" content="blog" />
<meta property="article:tag" content="r" />
<meta property="article:tag" content="ggplot" />
<meta property="article:tag" content="dataviz" />
<meta property="article:tag" content="economics" />


    <meta itemprop="name" content="Create supply and demand economics curves with ggplot2">
<meta itemprop="description" content="Use ggplot to create economics-style, non-data-based conceptual graphs."><meta itemprop="datePublished" content="2017-09-15T00:00:00+00:00" />
<meta itemprop="dateModified" content="2017-09-15T00:00:00+00:00" />
<meta itemprop="wordCount" content="2183"><meta itemprop="image" content="https://www.shagunjhaver.com/blog/2017/09/15/create-supply-and-demand-economics-curves-with-ggplot2/complete-example-1.png">
<meta itemprop="keywords" content="r,ggplot,dataviz,economics," />

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/pure-and-grids-responsive.min.css">
    <link rel="stylesheet" href="/css/ath-hugo.min.fd8cb76e3e71e1679716940ae61a1383ae9edd503b072df4bc3f709182421c76.css" integrity="sha256-/Yy3bj5x4WeXFpQK5hoTg66e3VA7By30vD9wkYJCHHY=" crossorigin="anonymous" media="screen" />

    <script src="https://kit.fontawesome.com/f9d343c40d.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">    

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=dLX2MbQJLG">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=dLX2MbQJLG">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=dLX2MbQJLG">
    <link rel="manifest" href="/site.webmanifest?v=dLX2MbQJLG">
    <link rel="mask-icon" href="/safari-pinned-tab.svg?v=dLX2MbQJLG" color="#cf4446">
    <link rel="shortcut icon" href="/favicon.ico?v=dLX2MbQJLG">
    <meta name="msapplication-TileColor" content="#170c3a">
    <meta name="theme-color" content="#170c3a">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-527449-5', 'auto');
      ga('send', 'pageview');
    </script>
</head>

<body>

    <div id="layout" class="pure-g">
        <div id="sidebar" class="pure-u-1 pure-u-md-1-4">
            <header>
                <h1 class="title"><a href="/">Shagun Jhaver</a></h1>
                <h2 class="minibio">Social computing, CSCW, HCI, content moderation, and online harassment</h2>

                <nav id="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a class="nav-link" href="/">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/cv/">CV</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/research/">Research</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/teaching/">Teaching</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/news/">News</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/now/">Now</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/work-with-me/">Work with me!</a>
                        </li>
                    </ul>
                </nav>
            </header>

        </div> 
    
        <div id="content" class="pure-u-1 pure-u-md-3-4">
        
  <section>
    <article class="content-single">
        <header class="post-header">
            <h1 class="post-title">Create supply and demand economics curves with ggplot2</h1>

            <div class="post-meta pure-g">
                <div class="pure-u-1-2">
                    <span class="posted-on">
                        <i class="far fa-calendar-alt" aria-hidden="true"></i>
                        <time datetime='2017-09-15T00:00:00Z'>
                            Friday, September 15, 2017
                        </time>
                    </span>
                </div>
                <div class="reading-time pure-u-1-2">
                    <i class="far fa-clock" aria-hidden="true"></i>
                    11-minute read
                </div>
            </div>
        </header>
    
        <div class="alert alert-primary">This is now an R package named <a href="https://github.com/andrewheiss/reconPlots"><code>reconPlots</code></a>.</div>
<p><span class="small">(<a href="#tldr">Skip to the tl;dr complete example</a>; <a href="https://github.com/andrewheiss/supply-demand-ggplot">see this mini project on GitHub</a>)</span></p>
<p>So far, teaching at BYU has been delightful. I&rsquo;ve been using static course-specific websites for the two classes I&rsquo;m teaching this semester—<a href="https://datavizf17.classes.andrewheiss.com/">data visualization</a> and <a href="https://storiesf17.classes.andrewheiss.com/">telling stories with data</a>—and it&rsquo;s been fantastic. Everything is self-contained and automated and magic and I&rsquo;m a huge fan of <a href="https://bookdown.org/yihui/blogdown/">blogdown</a>.</p>
<p>I&rsquo;m teaching basic microeconomics for public managers next semester. Economics is full of graphs, with supply curves, demand curves, intersections, lines, and shaded areas galore. However, these graphics are rarely connected to real data—they&rsquo;re conceptual—which makes them a little harder to plot with statistical graphics packages.</p>
<p>In the econ classes I took at BYU and Duke, I either drew problem set graphs by hand on paper or by hand in Illustrator, which was tedious and not very automatable. Since I&rsquo;m hoping to create another course-specific website with blogdown, I headed out to find an R-based solution for creating conceptual, non-data-based graphs.</p>
<p>After an <a href="https://twitter.com/bechhof/status/908484621800583168">initial call out on Twitter</a> and searches on Google, I found that the cool kids in econ either use OmniGraffle or Illustrator (which requires manual labor) or <a href="https://en.wikibooks.org/wiki/LaTeX/PGF/TikZ">tikz</a> to create their graphs. R Markdown and knitr <a href="https://github.com/yihui/knitr-examples/blob/master/058-engine-tikz.Rmd">support raw tikz chunks</a>, but only in LaTeX/PDF output (which makes sense, since tikz is essentially TeX). There&rsquo;s <a href="https://stackoverflow.com/a/41337307/120898">a hacky workaround to get tikz graphics in HTML output</a>, but <a href="https://twitter.com/andrewheiss/status/908506601849470976">it looks horrible</a>. Beyond these issues, I didn&rsquo;t want to learn yet another scripting language, so it was back to looking for R-only solutions.</p>
<p>To my delight, I came across <a href="http://is-r.tumblr.com/post/37631901708/economics-style-graphs-with-bezier-from-hmisc">this post from is.R() from 2012</a> where <a href="https://twitter.com/dsparks">David Sparks</a> essentially did exactly what I want to do—use ggplot to create conceptual non-data-based graphs. I borrowed extensively from David&rsquo;s original code and updated his system for my own graphs.</p>
<p>There are a couple key functions that make this work. First is <code>bezier()</code> from the <a href="https://cran.r-project.org/package=Hmisc">Hmisc package</a>, which generates a <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve">Bézier curve</a> from a set of coordinates. Importantly, though, we don&rsquo;t need to actually load the Hmisc package, since we only need <code>Hmisc::bezier()</code>. Loading the whole package muddies up the environment—in particular <code>Hmisc::summarize()</code> conflicts with <code>dplyr::summarize()</code> and can cause problems later.</p>
<p>First, we can create a supply curve:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(dplyr)
<span style="color:#a6e22e">library</span>(ggplot2)
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">supply <span style="color:#f92672">&lt;-</span> Hmisc<span style="color:#f92672">::</span><span style="color:#a6e22e">bezier</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>),
                        y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">9</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">as_data_frame</span>()

<span style="color:#a6e22e">ggplot</span>(supply, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#0073D9&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>()
</code></pre></div><figure class="img-75"><img src="generate-supply-1.png"
         alt="Generate supply curve"/>
</figure>

<p>We can adjust the curviness of the curve by moving the x and y coordinates around. For instance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">supply1 <span style="color:#f92672">&lt;-</span> Hmisc<span style="color:#f92672">::</span><span style="color:#a6e22e">bezier</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">9</span>),
                         y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">9</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">as_data_frame</span>()

supply2 <span style="color:#f92672">&lt;-</span> Hmisc<span style="color:#f92672">::</span><span style="color:#a6e22e">bezier</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">9</span>),
                         y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">9</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">as_data_frame</span>()

all_supply_curves <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bind_rows</span>(supply, supply1, supply2, .id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;id&#34;</span>)

<span style="color:#a6e22e">ggplot</span>(all_supply_curves, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, colour <span style="color:#f92672">=</span> id)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_color_manual</span>(values <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;#0073D9&#34;</span>, <span style="color:#e6db74">&#34;#001F40&#34;</span>, <span style="color:#e6db74">&#34;#80DBFF&#34;</span>)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>()
</code></pre></div><figure class="img-75"><img src="generate-supplies-1.png"
         alt="Lots of supply curves"/>
</figure>

<p>We can make a downward-sloping demand curve the same way. Since we&rsquo;re using two <code>geom_path()</code> layers here, we remove the <code>data</code> parameter to the main <code>ggplot()</code> function, but keep the aesthetic mapping.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">demand <span style="color:#f92672">&lt;-</span> Hmisc<span style="color:#f92672">::</span><span style="color:#a6e22e">bezier</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">9</span>),
                        <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">as_data_frame</span>()

<span style="color:#a6e22e">ggplot</span>(mapping <span style="color:#f92672">=</span> <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> supply, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#0073D9&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>()
</code></pre></div><figure class="img-75"><img src="generate-demand-1.png"
         alt="Generate demand curve"/>
</figure>

<p>The second key function for plotting these supply and demand graphs is a combination of <code>approxfun()</code> and <code>uniroot()</code>, which we use to find the intersection of the two curves. In his original post, Sparks created an <code>approxIntersection()</code> function to figure out intersections with brute force (i.e. create curves with hundreds of points and then look along the points to find where the coordinates are closest). In his post, he notes:</p>
<blockquote>
<p>This probably doesn’t work well in a lot of cases, and I would be interested in hearing of anyone’s less hacky solutions.</p>
</blockquote>
<p>So I wanted to try to find a less hacky solution. In <a href="https://stat.ethz.ch/pipermail/r-help/2011-July/282967.html">this old e-mail to r-help</a> about finding the intersection of two lines, it was suggested that:</p>
<blockquote>
<p>With linear interpolation, <code>uniroot()</code> on the difference between the two <code>approxfun()</code>s should get you there [the intersection of two curves] rather quickly.</p>
</blockquote>
<p>I&rsquo;ve used R for years and I&rsquo;d never heard of either of those functions. But I figured I&rsquo;d give it a try.</p>
<p><code>approxfun()</code> takes a matrix of data and approximates a function to fit that data. For example, we can generate a function for the supply curve and then plug in any x value to calculate the corresponding y. Here are the y values for 2, 6, and 8 (they should match the graphs above):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># I honestly have no idea why rule = 2, but things break when rule = 1, so ¯\_(ツ)_/¯</span>
fun_supply <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">approxfun</span>(supply<span style="color:#f92672">$</span>x, supply<span style="color:#f92672">$</span>y, rule <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

<span style="color:#a6e22e">fun_supply</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">8</span>))

<span style="color:#75715e">## [1] 1.590161 4.521605 6.805785</span>
</code></pre></div><p>Magic.</p>
<p>The <code>uniroot()</code> function can take a function and search across an interval for the root of that function (or, in this case, where two functions intersect). As said in the r-help post, we want to the root of the difference of the supply and demand curves. <code>uniroot</code> only accepts a single function, so we create an anonymous function where we calculate the difference between the two (<code>function(x) fun_supply(x) - fun_demand(x)</code>). We also want to search along the whole range of x, which currently goes from 1 to 9:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">fun_demand <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">approxfun</span>(demand<span style="color:#f92672">$</span>x, demand<span style="color:#f92672">$</span>y, rule <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)

intersection_funs <span style="color:#f92672">&lt;-</span>  <span style="color:#a6e22e">uniroot</span>(<span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">fun_supply</span>(x) <span style="color:#f92672">-</span> <span style="color:#a6e22e">fun_demand</span>(x), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">9</span>))
intersection_funs

<span style="color:#75715e">## $root</span>
<span style="color:#75715e">## [1] 4.654098</span>
<span style="color:#75715e">##</span>
<span style="color:#75715e">## $f.root</span>
<span style="color:#75715e">## [1] 0.000002875289</span>
<span style="color:#75715e">##</span>
<span style="color:#75715e">## $iter</span>
<span style="color:#75715e">## [1] 5</span>
<span style="color:#75715e">##</span>
<span style="color:#75715e">## $init.it</span>
<span style="color:#75715e">## [1] NA</span>
<span style="color:#75715e">##</span>
<span style="color:#75715e">## $estim.prec</span>
<span style="color:#75715e">## [1] 0.00006103516</span>
</code></pre></div><p>This gives a lot of output, but we only really care about the <code>$root</code> value, which is 4.654. And sure enough, it calculated the correct intersection!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">ggplot</span>(mapping <span style="color:#f92672">=</span> <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> supply, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#0073D9&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> intersection_funs<span style="color:#f92672">$</span>root, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>()
</code></pre></div><figure class="img-75"><img src="supply-demand-intersection-x-1.png"
         alt="Supply demand intersection for just x"/>
</figure>

<p>To get the horizontal intersection, we just have to find where the vertical intersection (4.654) shows up in the demand function. We calculate this by plugging the intersection into <code>fun_demand()</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">y_root <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">fun_demand</span>(intersection_funs<span style="color:#f92672">$</span>root)

<span style="color:#a6e22e">ggplot</span>(mapping <span style="color:#f92672">=</span> <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> supply, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#0073D9&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_vline</span>(xintercept <span style="color:#f92672">=</span> intersection_funs<span style="color:#f92672">$</span>root, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_hline</span>(yintercept <span style="color:#f92672">=</span> y_root, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>()
</code></pre></div><figure class="img-75"><img src="supply-demand-intersection-xy-1.png"
         alt="Supply demand intersection for both x and y"/>
</figure>

<p>Finding the intersections involves a lot of code, so we can put it all in a single function to make life easier later. This function only works on one intersection—it&rsquo;ll find the first intersection in the full range of the first curve. Finding multiple intersections <a href="https://stackoverflow.com/a/15298121/120898">requires more complicated logic</a>, but since I&rsquo;m not planning on plotting anything more complicated, I&rsquo;m fine with this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># curve1 and curve2 should be data.frames with an x and y column</span>
<span style="color:#75715e"># For instance, as_data_frame(Hmisc::bezier(c(1, 8, 9), c(1, 5, 9)))</span>
<span style="color:#75715e">#</span>
curve_intersect <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(curve1, curve2) {
  <span style="color:#75715e"># Approximate the functional form of both curves</span>
  curve1_f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">approxfun</span>(curve1<span style="color:#f92672">$</span>x, curve1<span style="color:#f92672">$</span>y, rule <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
  curve2_f <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">approxfun</span>(curve2<span style="color:#f92672">$</span>x, curve2<span style="color:#f92672">$</span>y, rule <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
  
  <span style="color:#75715e"># Calculate the intersection of curve 1 and curve 2 along the x-axis</span>
  point_x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">uniroot</span>(<span style="color:#a6e22e">function</span>(x) <span style="color:#a6e22e">curve1_f</span>(x) <span style="color:#f92672">-</span> <span style="color:#a6e22e">curve2_f</span>(x),
                     <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">min</span>(curve1<span style="color:#f92672">$</span>x), <span style="color:#a6e22e">max</span>(curve1<span style="color:#f92672">$</span>x)))<span style="color:#f92672">$</span>root
  
  <span style="color:#75715e"># Find where point_x is in curve 2</span>
  point_y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">curve2_f</span>(point_x)
  
  <span style="color:#75715e"># All done!</span>
  <span style="color:#a6e22e">return</span>(<span style="color:#a6e22e">list</span>(x <span style="color:#f92672">=</span> point_x, y <span style="color:#f92672">=</span> point_y))
}
</code></pre></div><p>The function returns a list with x and y values:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">intersection_xy <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">curve_intersect</span>(supply, demand)
intersection_xy

<span style="color:#75715e">## $x</span>
<span style="color:#75715e">## [1] 4.654098</span>
<span style="color:#75715e">##</span>
<span style="color:#75715e">## $y</span>
<span style="color:#75715e">## [1] 3.395557</span>
</code></pre></div><p>We can use this simpler list in the plot. Here, we stop using <code>geom_vline()</code> and <code>geom_hline()</code> and plot segments instead, stopping at the intersection of the curves (with a point at the intersection, just for fun):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">intersection_xy_df <span style="color:#f92672">&lt;-</span> intersection_xy <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">as_data_frame</span>()

<span style="color:#a6e22e">ggplot</span>(mapping <span style="color:#f92672">=</span> <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> supply, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#0073D9&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_segment</span>(data <span style="color:#f92672">=</span> intersection_xy_df,
               <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, xend <span style="color:#f92672">=</span> x, yend <span style="color:#f92672">=</span> y), lty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_segment</span>(data <span style="color:#f92672">=</span> intersection_xy_df,
               <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, y <span style="color:#f92672">=</span> y, xend <span style="color:#f92672">=</span> x, yend <span style="color:#f92672">=</span> y), lty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> intersection_xy_df, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Quantity&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Price&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>()
</code></pre></div><figure class="img-75"><img src="supply-demand-intersection-simple-1.png"
         alt="Simple supply demand intersection"/>
</figure>

<p>Now that we can quickly calculate the intersection of two curves, we can make more complicated plots, like adding a second demand curve and showing the change in price that results from the shift:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">demand2 <span style="color:#f92672">&lt;-</span> Hmisc<span style="color:#f92672">::</span><span style="color:#a6e22e">bezier</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">11</span>),
                         <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">as_data_frame</span>()

<span style="color:#75715e"># Make a data frame of the intersections of the supply curve and both demand curves</span>
intersections <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bind_rows</span>(<span style="color:#a6e22e">curve_intersect</span>(supply, demand),
                           <span style="color:#a6e22e">curve_intersect</span>(supply, demand2))

<span style="color:#a6e22e">ggplot</span>(mapping <span style="color:#f92672">=</span> <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> supply, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#0073D9&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand2, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_segment</span>(data <span style="color:#f92672">=</span> intersections,
               <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, xend <span style="color:#f92672">=</span> x, yend <span style="color:#f92672">=</span> y), lty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_segment</span>(data <span style="color:#f92672">=</span> intersections,
               <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, y <span style="color:#f92672">=</span> y, xend <span style="color:#f92672">=</span> x, yend <span style="color:#f92672">=</span> y), lty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> intersections, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Quantity&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Price&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>()
</code></pre></div><figure class="img-75"><img src="add-second-demand-curve-1.png"
         alt="Add second demand curve"/>
</figure>

<p>Super magic!</p>
<p>We can put a few final touches on it:</p>
<ul>
<li>Add an arrow with <code>annotate(&quot;segment&quot;, ...)</code></li>
<li>Force the line segments to the axes with <code>scale_*_continuous(expand = c(0, 0), ...)</code></li>
<li>Add breaks and labels on the axes for the segments with <code>scale_*_continuous(..., breaks = XXX, labels = XXX)</code>
<ul>
<li>We use <a href="https://stat.ethz.ch/R-manual/R-devel/library/grDevices/html/plotmath.html">plotmath</a> to get superscripted text in the labels using <code>expression(Q[1], Q[2])</code></li>
</ul>
</li>
<li>Add text annotations directly to the plot with <code>geom_text()</code>. We can use plotmath here too, but only if <code>parse = TRUE</code>.</li>
<li>Use a nicer font and make the title slightly bigger</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Create a data frame for the in-plot labels</span>
plot_labels <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data_frame</span>(label <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;S&#34;</span>, <span style="color:#e6db74">&#34;D[1]&#34;</span>, <span style="color:#e6db74">&#34;D[2]&#34;</span>),
                          x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>),
                          y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>))

<span style="color:#a6e22e">ggplot</span>(mapping <span style="color:#f92672">=</span> <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> supply, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#0073D9&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand2, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_segment</span>(data <span style="color:#f92672">=</span> intersections,
               <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, xend <span style="color:#f92672">=</span> x, yend <span style="color:#f92672">=</span> y), lty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_segment</span>(data <span style="color:#f92672">=</span> intersections,
               <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, y <span style="color:#f92672">=</span> y, xend <span style="color:#f92672">=</span> x, yend <span style="color:#f92672">=</span> y), lty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_text</span>(data <span style="color:#f92672">=</span> plot_labels,
            <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, label <span style="color:#f92672">=</span> label), parse <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
            family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source Sans Pro&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">annotate</span>(<span style="color:#e6db74">&#34;segment&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.5</span>, xend <span style="color:#f92672">=</span> <span style="color:#ae81ff">4.5</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>, yend <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>,
           arrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">arrow</span>(length <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;lines&#34;</span>)), colour <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey50&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> intersections, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_continuous</span>(expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>), breaks <span style="color:#f92672">=</span> intersections<span style="color:#f92672">$</span>x,
                     labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(Q[1], Q[2])) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_y_continuous</span>(expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>), breaks <span style="color:#f92672">=</span> intersections<span style="color:#f92672">$</span>y,
                     labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(P[1], P[2])) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Quantity&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Price&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Rightward shift in demand&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;As demand increases, so does price&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source Sans Pro&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source Sans Pro Semibold&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#a6e22e">rel</span>(<span style="color:#ae81ff">1.3</span>)))
</code></pre></div><figure class="img-75"><img src="all-together-now-1.png"
         alt="All together now!"/>
</figure>

<p>Perfect!</p>
<p>The only thing I have left to figure out is shading areas under the lines and curves to show consumer and producer surplus, but I&rsquo;ll get to that later (in theory, it should be a matter of using <code>geom_ribbon()</code>, <a href="https://stackoverflow.com/a/24419687/120898">like this</a>.)</p>
<h2 id="tldr">tl;dr</h2>
<p>All that explanation above makes the process sound more complicated than it actually is. Here&rsquo;s a complete example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">supply <span style="color:#f92672">&lt;-</span> Hmisc<span style="color:#f92672">::</span><span style="color:#a6e22e">bezier</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>),
                        <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">9</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">data.frame</span>()

demand1 <span style="color:#f92672">&lt;-</span> Hmisc<span style="color:#f92672">::</span><span style="color:#a6e22e">bezier</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">9</span>),
                         <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">data.frame</span>()

demand2 <span style="color:#f92672">&lt;-</span> Hmisc<span style="color:#f92672">::</span><span style="color:#a6e22e">bezier</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">11</span>),
                         <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">data.frame</span>()

<span style="color:#75715e"># Calculate the intersections of the two curves</span>
intersections <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">bind_rows</span>(<span style="color:#a6e22e">curve_intersect</span>(supply, demand1),
                           <span style="color:#a6e22e">curve_intersect</span>(supply, demand2))

plot_labels <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data_frame</span>(label <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;S&#34;</span>, <span style="color:#e6db74">&#34;D[1]&#34;</span>, <span style="color:#e6db74">&#34;D[2]&#34;</span>),
                          x <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>),
                          y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">8</span>))

<span style="color:#a6e22e">ggplot</span>(mapping <span style="color:#f92672">=</span> <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y)) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> supply, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#0073D9&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, linetype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dashed&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_path</span>(data <span style="color:#f92672">=</span> demand2, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#FF4036&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_segment</span>(data <span style="color:#f92672">=</span> intersections,
               <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, xend <span style="color:#f92672">=</span> x, yend <span style="color:#f92672">=</span> y), lty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_segment</span>(data <span style="color:#f92672">=</span> intersections,
               <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, y <span style="color:#f92672">=</span> y, xend <span style="color:#f92672">=</span> x, yend <span style="color:#f92672">=</span> y), lty <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;dotted&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_text</span>(data <span style="color:#f92672">=</span> plot_labels,
            <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, label <span style="color:#f92672">=</span> label), parse <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>,
            family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source Sans Pro&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">annotate</span>(<span style="color:#e6db74">&#34;segment&#34;</span>, x <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.5</span>, xend <span style="color:#f92672">=</span> <span style="color:#ae81ff">4.5</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>, yend <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>,
           arrow <span style="color:#f92672">=</span> <span style="color:#a6e22e">arrow</span>(length <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;lines&#34;</span>)), colour <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey50&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">geom_point</span>(data <span style="color:#f92672">=</span> intersections, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_x_continuous</span>(expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>), breaks <span style="color:#f92672">=</span> intersections<span style="color:#f92672">$</span>x,
                     labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(Q[1], Q[2])) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">scale_y_continuous</span>(expand <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>), breaks <span style="color:#f92672">=</span> intersections<span style="color:#f92672">$</span>y,
                     labels <span style="color:#f92672">=</span> <span style="color:#a6e22e">expression</span>(P[1], P[2])) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">labs</span>(x <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Quantity&#34;</span>, y <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Price&#34;</span>,
       title <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Rightward shift in demand&#34;</span>,
       subtitle <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;As demand increases, so does price&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">coord_equal</span>() <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme_classic</span>(base_family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source Sans Pro&#34;</span>) <span style="color:#f92672">+</span>
  <span style="color:#a6e22e">theme</span>(plot.title <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_text</span>(family <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Source Sans Pro Semibold&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#a6e22e">rel</span>(<span style="color:#ae81ff">1.3</span>)))
</code></pre></div><figure class="img-75"><img src="complete-example-1.png"
         alt="Complete example"/>
</figure>


    
        <footer>
            <div class="tags">
    <i class="fas fa-tags" aria-hidden="true"></i>&ensp;
    <a href="/blog/tags/r/">r</a>
    <span class="separator">•</span>
    <a href="/blog/tags/ggplot/">ggplot</a>
    <span class="separator">•</span>
    <a href="/blog/tags/dataviz/">dataviz</a>
    <span class="separator">•</span>
    <a href="/blog/tags/economics/">economics</a></div>

        </footer>

        <div id="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                 
                var disqus_shortname = 'andrewheisscom';
                var disqus_title = document.title;
                var disqus_url = 'https:\/\/www.shagunjhaver.com\/blog\/2017\/09\/15\/create-supply-and-demand-economics-curves-with-ggplot2\/';

                 
                (function () {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
                    Disqus.</a></noscript>
        </div>
    </article>
</section>

  

        </div> 
    </div> 
    
    <div id="footer">
        <footer>
    <ul class="links">
        <li>
            <a href="mailto:shagun.jhaver@rutgers.edu" aria-label="E-mail"   >
                <i class="fa fa-envelope" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://medium.com/@shagunjhaver" aria-label="Medium"   >
                <i class="fab fa-medium" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://scholar.google.com/citations?user=OgtKT6UAAAAJ" aria-label="Google Scholar"   >
                <i class="ai ai-google-scholar" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://dl.acm.org/author_page.cfm?id=99658987207" aria-label="ACM Digital Library"   >
                <i class="ai ai-acmdl-square" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://github.com/shaguniitb" aria-label="GitHub"   >
                <i class="fab fa-github" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://twitter.com/shagunjhaver" aria-label="Twitter"   >
                <i class="fab fa-twitter" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://www.facebook.com/shagun.jhaver" aria-label="Facebook"   >
                <i class="fab fa-facebook" aria-hidden="true"></i>
            </a>
        </li>
        <li>
            <a href="https://www.linkedin.com/in/shagun-jhaver/" aria-label="LinkedIn"   >
                <i class="fab fa-linkedin" aria-hidden="true"></i>
            </a>
        </li>
    </ul>

    <p class="colophon"> <i class="fas fa-map-marker-alt"></i> New Brunswick, NJ </p>
    <p class="colophon">ORCID iD: <a href="https://orcid.org/0000-0002-6728-7101">0000-0002-6728-7101</a></p>

   <p class="colophon">
    This site is a derivative of <a href="https://github.com/andrewheiss/ath-hugo">ath-hugo</a> by Andrew Heiss, used under CC <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">4.0</a>.
   </p>


    <p class="colophon"><a href="https://github.com/shaguniitb/ath-hugo">Code for site</a></p>
</footer>

    </div>

</body>

</html>
